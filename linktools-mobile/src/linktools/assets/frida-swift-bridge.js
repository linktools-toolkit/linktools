(()=>{var t=["pointer","pointer"],e=null,s=null;function i(){if(Process.arch!=="arm64"||Process.platform!=="darwin")throw new Error("Only arm64(e) Darwin is currently supported");if(e!==null)return e;e=r([{module:"libswiftCore.dylib",functions:{swift_demangle:["pointer",["pointer","size_t","pointer","pointer","int32"]]}}]);let t=r([{module:"libswiftCore.dylib",functions:{swift_allocBox:[["pointer","pointer"],["pointer"]]}}]);return e=Object.assign(e,t),e}function d(){if(s!==null)return s;if(Process.getModuleByName("CoreFoundation").ensureInitialized(),Process.findModuleByName("CoreSymbolication")===null)try{Module.load("/System/Library/PrivateFrameworks/CoreSymbolication.framework/CoreSymbolication")}catch{Module.load("/System/Library/PrivateFrameworks/CoreSymbolication.framework/Versions/A/CoreSymbolication")}return s=r([{module:"libmacho.dylib",functions:{getsectiondata:["pointer",["pointer","pointer","pointer","pointer"]]}},{module:"CoreSymbolication",functions:{CSSymbolicatorCreateWithPid:[t,["int"]],CSSymbolicatorCreateWithTask:[t,["uint"]],CSSymbolicatorGetSymbolWithAddressAtTime:[t,[t,"pointer","uint64"]],CSIsNull:["bool",[t]],CSSymbolGetMangledName:["pointer",[t]],CSRelease:["void",[t]]}},{module:"libsystem_kernel.dylib",functions:{mach_task_self:["uint",[]]}}]),s}function r(e){let a={};for(let t of e){let i=Process.getModuleByName(t.module);i.ensureInitialized();for(let[e,[s,r]]of Object.entries(t.functions)){let t=i.getExportByName(e);a[e]=new NativeFunction(t,s,r)}}return a}var a;(function(t){t[t.AlignmentMask=255]="AlignmentMask",t[t.IsNonPOD=65536]="IsNonPOD",t[t.IsNonInline=131072]="IsNonInline",t[t.HasSpareBits=524288]="HasSpareBits",t[t.IsNonBitwiseTakable=1048576]="IsNonBitwiseTakable",t[t.HasEnumWitnesses=2097152]="HasEnumWitnesses",t[t.Incomplete=4194304]="Incomplete"})(a||(a={}));var D=class{data;constructor(t){this.data=t}get isInlineStorage(){return!(this.data&a.IsNonInline)}get isPOD(){return!(this.data&a.IsNonPOD)}get isBitwiseTakable(){return!(this.data&a.IsNonBitwiseTakable)}getAlignmentMask(){return this.data&a.AlignmentMask}},u;(function(t){t[t.Class=0]="Class",t[t.Struct=512]="Struct",t[t.Enum=513]="Enum",t[t.LastEnumerated=2047]="LastEnumerated"})(u||(u={}));function x(t){return t>u.LastEnumerated?u.Class:t}var l;(function(t){t[t.Module=0]="Module",t[t.Extension=1]="Extension",t[t.Anonymous=2]="Anonymous",t[t.Protocol=3]="Protocol",t[t.OpaqueType=4]="OpaqueType",t[t.TypeFirst=16]="TypeFirst",t[t.Class=16]="Class",t[t.Struct=17]="Struct",t[t.Enum=18]="Enum"})(l||(l={}));var n;(function(t){t[t.MetadataInitialization=0]="MetadataInitialization",t[t.MetadataInitialization_width=2]="MetadataInitialization_width",t[t.Class_ResilientSuperclassReferenceKind=9]="Class_ResilientSuperclassReferenceKind",t[t.Class_HasResilientSuperclass=13]="Class_HasResilientSuperclass",t[t.Class_HasOverrideTable=14]="Class_HasOverrideTable",t[t.Class_HasVTable=15]="Class_HasVTable"})(n||(n={}));var o;(function(t){t[t.NoMetadataInitialization=0]="NoMetadataInitialization",t[t.SingletonMetadataInitialization=1]="SingletonMetadataInitialization",t[t.ForeignMetadataInitialization=2]="ForeignMetadataInitialization"})(o||(o={}));var L=class{value;constructor(t){this.value=t}class_hasVTable(){return!!(this.value&1<<n.Class_HasVTable)}class_hasResilientSuperClass(){return!!(this.value&1<<n.Class_HasResilientSuperclass)}class_hasOverrideTable(){return!!(this.value&1<<n.Class_HasOverrideTable)}getMetadataInitialization(){return k(this.value,n.MetadataInitialization,n.MetadataInitialization_width)}hasSingletonMetadataInitialization(){return this.getMetadataInitialization()===o.SingletonMetadataInitialization}hasForeignMetadataInitialization(){return this.getMetadataInitialization()===o.ForeignMetadataInitialization}};function k(t,e,s){return t>>>e&~(-1<<s)}var c;(function(t){t[t.Method=0]="Method",t[t.Init=1]="Init",t[t.Getter=2]="Getter",t[t.Setter=3]="Setter",t[t.ModifyCoroutine=4]="ModifyCoroutine",t[t.ReadCoroutine=5]="ReadCoroutine"})(c||(c={}));var U=class ${value;static KindMask=15;constructor(t){this.value=t}getKind(){return this.value&$.KindMask}},h;(function(t){t[t.DirectTypeDescriptor=0]="DirectTypeDescriptor",t[t.IndirectTypeDescriptor=1]="IndirectTypeDescriptor",t[t.DirectObjCClassName=2]="DirectObjCClassName",t[t.IndirectObjCClass=3]="IndirectObjCClass"})(h||(h={}));var f;(function(t){t[t.TypeMetadataKindMask=56]="TypeMetadataKindMask",t[t.TypeMetadataKindShift=3]="TypeMetadataKindShift"})(f||(f={}));var j=class{value;constructor(t){this.value=t}getTypeReferenceKind(){return(this.value&f.TypeMetadataKindMask)>>f.TypeMetadataKindShift}},V=class{static Class=!1;static Any=!0},W;(function(t){t[t.HasClassConstratint=0]="HasClassConstratint",t[t.HasClassConstratint_width=1]="HasClassConstratint_width"})(W||(W={}));var K=class{bits;constructor(t){this.bits=t}getClassConstraint(){return!!(this.bits&1<<W.HasClassConstratint)}};var m=class ${handle;offset;static sizeOf=4;static From(t){let e=t.readS32();return e===0?null:new $(t,e)}constructor(t,e){this.handle=t,this.offset=e}get(){return this.handle.add(this.offset)}},G=class ${handle;offset;static From(t){let e=t.readS32();return e===0?null:new $(t,e)}constructor(t,e){this.handle=t,this.offset=e}get(){let t=this.handle.add(this.offset&-2);return this.offset&1?t.readPointer():t}};var B=class{handle;static SIZEOF=Process.pointerSize*2;metadata;refCounts;constructor(t){this.handle=t}getMetadata(t){return new t(this.handle.readPointer())}},H=class{object;buffer;constructor(t){this.object=new B(t[0]),this.buffer=t[1]}};var Z=class{privateData;constructor(t){this.privateData=t}},g=class ${handle;static OFFSETOF_KIND=0;#t;constructor(t){this.handle=t,this.#t=this.handle.add($.OFFSETOF_KIND).readU32()}getKind(){return x(this.#t)}isClassObject(){return this.getKind()==u.Class}getValueWitnesses(){let t=this.getKind();if(t!==u.Enum&&t!==u.Struct)throw new Error(`Kind does not have a VWT: ${t}`);let e=this.handle.sub(Process.pointerSize).readPointer();return new Y(e)}getTypeLayout(){let t=this.getValueWitnesses();return{size:t.size,stride:t.stride,flags:t.flags.data,extraInhabitantCount:t.extraInhabitantCount}}vw_initializeWithCopy(t,e){return this.getValueWitnesses().initializeWithCopy(t,e,this.handle)}vw_getEnumTag(t){return this.getValueWitnesses().asEVWT().getEnumTag(t)}vw_destructiveInjectEnumTag(t,e){return this.getValueWitnesses().asEVWT().destructiveInjectEnumTag(t,e)}allocateBoxForExistentialIn(t){if(this.getValueWitnesses().isValueInline())return t.privateData;let e=i(),s=new H(e.swift_allocBox(this.handle));return t.privateData.writePointer(s.object.handle),s.buffer}getFullTypeName(){return this.getDescription().getFullTypeName()}static from(t){switch(new p(t).getKind()){case u.Class:return new F(t);case u.Struct:return new q(t);case u.Enum:return new J(t);default:throw new Error("Unknown metadata kind")}}toJSON(){return{handle:this.handle,name:this.getFullTypeName()}}},p=class $ extends g{static OFFSETOF_DESCRIPTION=Process.pointerSize;#t;get description(){return this.#t===void 0&&(this.#t=this.handle.add($.OFFSETOF_DESCRIPTION).readPointer()),this.#t}getDescription(){return new et(this.description)}},F=class $ extends g{static OFFSTETOF_DESCRIPTION=Process.pointerSize*8;#t;get description(){return this.#t===void 0&&(this.#t=this.handle.add($.OFFSTETOF_DESCRIPTION).readPointer()),this.#t}getDescription(){return new st(this.description)}},q=class extends p{getDescription(){return new at(this.description)}},J=class extends p{getDescription(){return new nt(this.description)}},Y=class ${handle;static OFFSETOF_INTIALIZE_WITH_COPY=16;static OFFSETOF_SIZE=64;static OFFSETOF_STRIDE=72;static OFFSETOF_FLAGS=80;static OFFSETOF_EXTRA_INHABITANT_COUNT=84;initializeWithCopy;size;stride;flags;extraInhabitantCount;constructor(t){this.handle=t;let e=this.handle.add($.OFFSETOF_INTIALIZE_WITH_COPY).readPointer(),r=new NativeFunction(e,"pointer",["pointer","pointer","pointer"]);this.initializeWithCopy=(t,e,s)=>r(t,e,s),this.size=this.getSize(),this.stride=this.getStride(),this.flags=this.getFlags(),this.extraInhabitantCount=this.getExtraInhabitantCount()}isValueInline(){return this.flags.isInlineStorage}getSize(){return this.handle.add($.OFFSETOF_SIZE).readU64().toNumber()}getStride(){return this.handle.add($.OFFSETOF_STRIDE).readU64().toNumber()}getAlignmentMask(){return this.flags.getAlignmentMask()}getFlags(){let t=this.handle.add($.OFFSETOF_FLAGS).readU32();return new D(t)}getExtraInhabitantCount(){return this.handle.add($.OFFSETOF_EXTRA_INHABITANT_COUNT).readU32()}asEVWT(){return new X(this.handle)}},X=class $ extends Y{static OFFSETOF_GET_ENUM_TAG=88;static OFFSETOF_DESTRUCTIVE_INJECT_ENUM_TAG=104;getEnumTag;destructiveInjectEnumTag;constructor(t){super(t);let e=this.handle.add($.OFFSETOF_GET_ENUM_TAG).readPointer(),s=new NativeFunction(e,"uint32",["pointer","pointer"]);this.getEnumTag=t=>s(t,this.handle),e=this.handle.add($.OFFSETOF_DESTRUCTIVE_INJECT_ENUM_TAG).readPointer();let r=new NativeFunction(e,"void",["pointer","uint32","pointer"]);this.destructiveInjectEnumTag=(t,e)=>r(t,e,this.handle)}},Q=class ${handle;static OFFSETOF_FLAGS=0;static OFFSETOF_PARENT=4;#t;#e;constructor(t){this.handle=t}get flags(){if(this.#t!=null)return this.#t;let t=this.handle.add($.OFFSETOF_FLAGS).readU32();return new ut(t)}get parent(){return this.#e!==void 0?this.#e:(this.#e=G.From(this.handle.add($.OFFSETOF_PARENT)),this.#e)}isGeneric(){return this.flags.isGeneric()}getKind(){return this.flags.getKind()}getModuleContext(){let t=new tt(this.parent.get());for(;t.flags.getKind()!==l.Module;)t=new tt(t.parent.get());return t}},tt=class $ extends Q{static OFFSETOF_NAME=8;#t;get name(){if(this.#t!==void 0)return this.#t;let t=this.handle.add($.OFFSETOF_NAME),e=m.From(t).get();return this.#t=e.readCString(),this.#t}},S=class $ extends Q{static OFFSETOF_NAME=8;static OFFSETOF_ACCESS_FUNCTION_PTR=12;static OFFSETOF_FIELDS=16;#t;#e;#n;getTypeContextDescriptorFlags(){return new L(this.flags.getKindSpecificFlags())}get name(){if(this.#t!==void 0)return this.#t;let t=m.From(this.handle.add($.OFFSETOF_NAME)).get();return this.#t=t.readUtf8String(),this.#t}get accessFunctionPointer(){return this.#e!==void 0?this.#e:m.From(this.handle.add($.OFFSETOF_ACCESS_FUNCTION_PTR)).get()}get fields(){return this.#n!==void 0?this.#n:m.From(this.handle.add($.OFFSETOF_FIELDS))}isReflectable(){return this.fields!==null}getAccessFunction(){return new NativeFunction(this.accessFunctionPointer,"pointer",[])}getFullTypeName(){return`${this.getModuleContext().name}.${this.name}`}},et=class extends S{},st=class $ extends S{static OFFSETOF_TARGET_VTABLE_DESCRIPTOR_HEADER=44;static OFFSETOF_METHOD_DESCRIPTORS=52;hasVTable(){return this.getTypeContextDescriptorFlags().class_hasVTable()}hasResilientSuperClass(){return this.getTypeContextDescriptorFlags().class_hasResilientSuperClass()}hasOverrideTable(){return this.getTypeContextDescriptorFlags().class_hasOverrideTable()}hasSingletonMetadataInitialization(){return this.getTypeContextDescriptorFlags().hasSingletonMetadataInitialization()}hasForeignMetadataInitialization(){return this.getTypeContextDescriptorFlags().hasForeignMetadataInitialization()}getVTableDescriptor(){if(!this.hasVTable())return null;let t=this.handle.add($.OFFSETOF_TARGET_VTABLE_DESCRIPTOR_HEADER);return new rt(t)}getMethodDescriptors(){let e=[];if(!this.hasVTable()||this.isGeneric()||this.hasResilientSuperClass()||this.hasOverrideTable()||this.hasSingletonMetadataInitialization()||this.hasForeignMetadataInitialization())return e;let t=this.getVTableDescriptor().vtableSize,s=this.handle.add($.OFFSETOF_METHOD_DESCRIPTORS),r=s.add(t*it.sizeof);for(;!s.equals(r);s=s.add(it.sizeof)){let t=new it(s);t.impl!==null&&e.push(t)}return e}},rt=class ${handle;static OFFSETOF_VTABLE_OFFSET=0;static OFFSETOF_VTABLE_SIZE=4;#t;constructor(t){this.handle=t}get vtableSize(){return this.#t!==void 0?this.#t:this.handle.add($.OFFSETOF_VTABLE_SIZE).readU32()}},it=class ${handle;static OFFSETOF_FLAGS=0;static OFFSETOF_IMPL=4;static sizeof=8;#t;#e;constructor(t){this.handle=t}get flags(){if(this.#t!==void 0)return this.#t;let t=this.handle.add($.OFFSETOF_FLAGS).readU32();return new U(t)}get impl(){if(this.#e!==void 0)return this.#e;let t=this.handle.add($.OFFSETOF_IMPL);return m.From(t)}},at=class $ extends S{static OFFSETOF_NUM_FIELDS=24;static OFFSETOF_FIELD_OFFSET_VECTOR_OFFSET=28;#t;#e;hasFieldOffsetVector(){return this.fieldOffsetVectorOffset!==0}get numFields(){return this.#t!==void 0?this.#t:this.handle.add($.OFFSETOF_NUM_FIELDS).readU32()}get fieldOffsetVectorOffset(){return this.#e!==void 0?this.#e:this.handle.add($.OFFSETOF_FIELD_OFFSET_VECTOR_OFFSET).readU32()}},nt=class $ extends S{static OFFSETOF_NUM_PAYLOAD_CASES_AND_PAYLOAD_SIZE_OFFSET=20;static OFFSETOF_NUM_EMPTY_CASES=24;#t;#e;get numPayloadCasesAndPayloaadSizeOffset(){if(this.#t===void 0){let t=this.handle.add($.OFFSETOF_NUM_PAYLOAD_CASES_AND_PAYLOAD_SIZE_OFFSET).readU32();this.#t=t}return this.#t}get numEmptyCases(){return this.#e===void 0&&(this.#e=this.handle.add($.OFFSETOF_NUM_EMPTY_CASES).readU32()),this.#e}getNumPayloadCases(){return this.numPayloadCasesAndPayloaadSizeOffset&16777215}getNumEmptyCases(){return this.numEmptyCases}getNumCases(){return this.getNumPayloadCases()+this.numEmptyCases}isPayloadTag(t){return this.getNumCases()>0&&t<this.getNumPayloadCases()}},ot=class $ extends Q{static OFFSETOF_NAME=8;static OFFSETOF_NUM_REQUIREMENTS=16;#t;#e;constructor(t){super(t)}get name(){if(this.#t===void 0){let t=m.From(this.handle.add($.OFFSETOF_NAME)).get();this.#t=t.readCString()}return this.#t}get numRequirements(){if(this.#e===void 0){let t=this.handle.add($.OFFSETOF_NUM_REQUIREMENTS);this.#e=t.readU32()}return this.#e}getProtocolContextDescriptorFlags(){return new K(this.flags.getKindSpecificFlags())}getFullProtocolName(){return this.getModuleContext().name+"."+this.name}},lt=class{handle;constructor(t){this.handle=t}getTypeDescriptor(t){let e=null;switch(t){case h.DirectTypeDescriptor:e=m.From(this.handle).get();break;case h.IndirectTypeDescriptor:e=m.From(this.handle).get(),e=e.readPointer();break;case h.DirectObjCClassName:case h.IndirectObjCClass:break}return e}},dt=class ${handle;static OFFSETOF_PROTOTCOL=0;static OFFSETOF_TYPE_REF=4;static OFFSTEOF_WITNESS_TABLE_PATTERN=8;static OFFSETOF_FLAGS=12;static OFFSETOF_WITNESS_TABLE_PATTERN=16;#t;#e;#n;#r;constructor(t){this.handle=t}get protocol(){return this.#t===void 0&&(this.#t=G.From(this.handle.add($.OFFSETOF_PROTOTCOL)).get()),this.#t}get typeRef(){if(this.#e===void 0){let t=this.handle.add($.OFFSETOF_TYPE_REF);this.#e=new lt(t)}return this.#e}get witnessTablePattern(){if(this.#n===void 0){let t=m.From(this.handle.add($.OFFSTEOF_WITNESS_TABLE_PATTERN));this.#n=t?t.get():null}return this.#n}get flags(){if(this.#r===void 0){let t=this.handle.add($.OFFSETOF_FLAGS);this.#r=new j(t.readU32())}return this.#r}getTypeKind(){return this.flags.getTypeReferenceKind()}getTypeDescriptor(){return this.typeRef.getTypeDescriptor(this.getTypeKind())}},ut=class{value;constructor(t){this.value=t}getKind(){return this.value&31}isGeneric(){return(this.value&128)!==0}getIntValue(){return this.value}getKindSpecificFlags(){return this.value>>>16&65535}};var ct=0x8000000000000000,ht=new Map,T=null;function ft(t){let e=d(),s=e.CSSymbolicatorGetSymbolWithAddressAtTime(Tt(),t,ct);if(e.CSIsNull(s))return;let r=e.CSSymbolGetMangledName(s).readCString();if(r!==null)return mt(r)}function mt(s){if(!gt(s))return;let t=ht.get(s);if(t!==void 0)return t;let r=i();try{let t=Memory.allocUtf8String(s),e=r.swift_demangle(t,s.length,ptr(0),ptr(0),0).readUtf8String();return ht.set(s,e),e}catch{return}}function gt(e){if(e.length==0)return!1;let s=["_T0","$S","_$S","$s","_$s"];for(let t of s)if(e.startsWith(t))return!0;return!1}function pt(t){let e=/([a-zA-Z_]\w+)(<.+>)*\(.*\) -> ([\w.]+(?: & [\w.]+)*|\([\w.]*\))$/g,s=/(\w+): ([\w.]+)(?:, )*|\(([\w.]+)\)/g,r=e.exec(t);if(r===null)throw new Error("Couldn't parse function with signature: "+t);let i=r[1],a=r[3]||"void";if(i===void 0)throw new Error("Couldn't parse function with signature: "+t);let n=[],o=[],l;for(;(l=s.exec(t))!==null;){let t=l[3];t!==void 0?(n.push(""),o.push(t)):(n.push(l[1]),o.push(l[2]))}if(n.length!==o.length)throw new Error("Couldn't parse function with signature: "+t);let d=i;return n.length>0&&(d+="$"+n.join("_")+"_"),{methodName:i,argNames:n,argTypeNames:o,retTypeName:a,jsSignature:d}}function Ft(t){try{return pt(t)}catch{return}}function St(t){let e=/(\w+).(getter|setter) : ([\w.]+)$/g.exec(t);if(e===null)throw new Error("Couldn't parse accessor signature "+t);let s=e[2];if(s!=="getter"&&s!=="setter")throw new Error("Couldn't parse accessor signature "+t);let r=e[1],i=e[3];return{accessorType:s,memberName:r,memberTypeName:i}}function Tt(){if(T!==null)return T;let t=d(),e=t.CSSymbolicatorCreateWithPid(Process.id);if(t.CSIsNull(e)&&(e=t.CSSymbolicatorCreateWithTask(t.mach_task_self()),t.CSIsNull(e)))throw new Error("Failed to create symbolicator");return T=e,Script.bindWeak(T,Ot),e}function Et(t){let e=/protocol conformance descriptor for \S+ : \S+\.(\S+) in \S+/g.exec(t);return e===null?null:e[1]}function Ot(){d().CSRelease(T)}var yt=class ${handle;numWitnessTables;static INITIAL_SIZE=4*Process.pointerSize;static OFFSETOF={buffer:0,type:Process.pointerSize*3,wintessTable:Process.pointerSize*4};#t;#e;constructor(t,e){this.handle=t,this.numWitnessTables=e}static alloc(t){let e=$.INITIAL_SIZE+t*Process.pointerSize,s=Memory.alloc(e);return new $(s,t)}static makeFromRaw(t,e){let s=new $(t,e),r=t.add($.OFFSETOF.type).readPointer(),i=new p(r);return s.#e=i.isClassObject()?new F(r):i,s}set type(t){this.handle.add($.OFFSETOF.type).writePointer(t.handle),this.#e=t}get buffer(){return this.#t===void 0&&(this.#t=new Z(this.handle)),this.#t}get type(){return this.#e}getWitnessTables(){return this.handle.add($.OFFSETOF.wintessTable)}isValueInline(){return this.type.getValueWitnesses().isValueInline()}projectValue(){let t=this.type.getValueWitnesses();if(t.isValueInline())return this.buffer.privateData;let e=this.buffer.privateData.readPointer(),s=t.getAlignmentMask(),r=B.SIZEOF+s&~s;return e.add(r)}get sizeof(){return $.INITIAL_SIZE+this.numWitnessTables*Process.pointerSize}},wt=class ${handle;numWitnessTables;static INITIAL_SIZE=Process.pointerSize;static OFFSETOF={value:0,witnessTables:Process.pointerSize};#t;constructor(t,e){this.handle=t,this.numWitnessTables=e}static alloc(t){let e=$.INITIAL_SIZE+t*Process.pointerSize,s=Memory.alloc(e);return new $(s,t)}static makeFromRaw(t,e){let s=new $(t,e);return s.#t=t.add($.OFFSETOF.value).readPointer(),s}get value(){return this.#t}set value(t){this.handle.add($.OFFSETOF.value).writePointer(t),this.#t=t}getWitnessTables(){return this.handle.add($.OFFSETOF.witnessTables)}get sizeof(){return $.INITIAL_SIZE+this.numWitnessTables*Process.pointerSize}};var Ct=new ModuleMap,E={},O={},_t=new Map;if(Process.arch==="arm64"&&Process.platform==="darwin"){for(let e of Ct.values()){for(let t of Mt(e))O[t.getFullTypeName()]={descriptor:t,conformances:{}};for(let t of At(e))E[t.getFullProtocolName()]=t}for(let t of Ct.values())zt(t)}function It(){return Object.values(O)}function y(t){let e=O[t];if(e===void 0)throw new Error("Type not found: "+t);if(e.metadata!==void 0)return O[t].metadata;let s=e.descriptor.getAccessFunction().call(),r=g.from(s);return O[t].metadata=r,r}function w(t,e){let s=O[t];if(s===void 0)throw new Error("Type not found: "+t);if(s.metadata!==void 0)return O[t].metadata;let r=s.descriptor.getAccessFunction().call(),i=new e(r);return O[t].metadata=i,i}function vt(t){let e=O[t];if(e===void 0)throw new Error("Type not found: "+t);return e.conformances}function bt(){return Object.values(E)}function Nt(t){return E[t]}function Pt(t){let e=E[t];if(e===void 0)throw new Error(`Can't find protocol descriptor for: "${t}"`);return e}function Mt(t){let n=[],o=Rt(t),e=o.size/m.sizeOf;for(let a=0;a<e;a++){let t=o.vmAddress.add(a*m.sizeOf),e=m.From(t).get(),s=new S(e);if(s.isGeneric())continue;let r=s.getKind(),i;switch(r){case l.Class:i=new st(e);break;case l.Struct:i=new at(e);break;case l.Enum:i=new nt(e);break;default:continue}n.push(i)}return n}function At(t){let i=[],a=$t(t),e=a.size/m.sizeOf;for(let r=0;r<e;r++){let t=a.vmAddress.add(r*m.sizeOf),e=m.From(t).get(),s=new ot(e);i.push(s)}return i}function zt(t){let o=Dt(t),e=o.size/m.sizeOf;for(let n=0;n<e;n++){let t=o.vmAddress.add(n*m.sizeOf),s=m.From(t).get(),e=new dt(s),r=e.getTypeDescriptor(),i=new S(r);if(r===null||i.isGeneric()||i.getKind()===l.Protocol)continue;let a=O[i.getFullTypeName()];if(a!==void 0)if(e.protocol.isNull()){let t=ft(s),e=Et(t);if(e===null){console.warn(`Failed to parse protocol name from conformance descriptor '${t}'. Please file a bug.`);continue}a.conformances[e]={protocol:null,witnessTable:null}}else{let t=new ot(e.protocol);a.conformances[t.name]={protocol:t,witnessTable:e.witnessTablePattern}}}}function Rt(t){return xt(t,"__swift5_types")}function $t(t){return xt(t,"__swift5_protos")}function Dt(t){return xt(t,"__swift5_proto")}function xt(t,e,s="__TEXT"){let r=t.base,i=Memory.allocUtf8String(s),a=Memory.allocUtf8String(e),n=Memory.alloc(Process.pointerSize),o=d().getsectiondata(r,i,a,n),l=n.readU32();return{vmAddress:o,size:l}}function Lt(t){if(Ct.find(t)===null)return;let e=t.toString(),s=_t.get(e);if(s!==void 0)return s;let r=ft(t);if(r!==void 0)return _t.set(e,r),r}function kt(t){let e=Lt(t);if(e===void 0)throw new Error("Can't find symbol at "+t.toString());return e}function C(i){Array.isArray(i)||(i=[i]);let t=Process.pointerSize*i.length,a=Memory.alloc(t);for(let s=0,r=0;r<t;s++,r+=Process.pointerSize){let t=i[s],e=a.add(r);t instanceof NativePointer?e.writePointer(t):e.writeU64(t)}return a}function Ut(e,s){let r=[];for(let t=0;t<s;t+=8)r.push(e.add(t).readU64());return r}function jt(s,r){let i=Process.pointerSize*s.length;for(let t=0,e=0;e<i;t++,e+=Process.pointerSize)r.add(e).writeU64(s[t])}function _(t){return t=t<8?8:t,t/8}var Vt=Process.pointerSize*4,Wt="x8",Kt=class ${static pages;static currentSlot;static get currentPage(){return $.pages[$.pages.length-1]}static _initialize(){$.pages=[Memory.alloc(Process.pageSize)],$.currentSlot=$.currentPage}static allocateTrampoline(t){$.pages===void 0&&$._initialize();let e=$.currentPage,s=e.add(Process.pageSize);$.currentSlot.add(t).compare(s)>0&&(e=Memory.alloc(Process.pageSize),$.pages.push(e));let r=$.currentSlot;return $.currentSlot=$.currentSlot.add(t),r}};function I(t,r,l,e,s){let i=l.map(t=>Gt(t)),a=Gt(r),n=new qt(t,a,i,e).wrapper;return Object.assign(function(...t){let o=[];for(let[r,i]of t.entries()){let t=l[r];if(typeof t=="string"||Array.isArray(t)){o.push(i);continue}if(t instanceof g){o.push(Bt(i));continue}let e=t,a=i.$metadata,s;if(e.isClassOnly)s=wt.alloc(e.numProtocols),s.value=i.handle;else if(s=yt.alloc(e.numProtocols),s.type=a,a.isClassObject())s.buffer.privateData.writePointer(i.handle);else{let t=a.allocateBoxForExistentialIn(s.buffer);a.vw_initializeWithCopy(t,i.handle)}let n=s.getWitnessTables();for(let[r,i]of e.protocols.entries()){let t=a.getFullTypeName(),e=vt(t)[i.name];if(e===void 0)throw new Error(`Type ${t} does not conform to protocol ${i.name}`);let s=e.witnessTable;n.add(r*Process.pointerSize).writePointer(s)}o.push(Bt(s))}let e=n(...o);if(typeof r=="string"||Array.isArray(r))return e;if(r instanceof g)switch(r.getKind()){case u.Struct:return new M(r,{raw:e});case u.Enum:return new A(r,{raw:e});case u.Class:return new z(e);default:throw new Error("Unimplemented kind: "+r.getKind())}let s=C(e);return P.fromExistentialContainer(s,r)},{address:t})}function Gt(e){if(typeof e=="string"||Array.isArray(e))return e;if(e instanceof N){let t=Array(e.numProtocols).fill("pointer");return e.isClassOnly?["pointer",...t]:["pointer","pointer","pointer","pointer",...t]}if(e.getKind()===u.Class||Ht(e))return"pointer";let t=e.getTypeLayout().stride/8;return t=t>1?t:1,Array(t).fill("uint64")}function Bt(t){if(t instanceof z)return t.handle;if(t instanceof yt)return Ut(t.handle,t.sizeof);if(t instanceof wt){let e=t,s=[];for(let t=0;t!=e.sizeof;t+=8)s.push(e.handle.add(t).readPointer());return s}return Ht(t.$metadata)?t.handle:Ut(t.handle,t.$metadata.getTypeLayout().stride)}function Ht(t){return!t.getValueWitnesses().flags.isBitwiseTakable}var Zt=class{#t={};#e=0;get length(){return Object.keys(this.#t).length-this.#e}enqueue(t){let e=Object.keys(this.#t).length;this.#t[e]=t}dequeue(){return Object.keys(this.#t).length===0?void 0:this.#t[this.#e++]}resetCursor(){this.#e=0}toJSON(){return this.#t}},qt=class{#t;#e;#n;#r;#s;#i;constructor(e,t,s,i,a){this.#t=new Zt,s=s.map(e=>{if(Array.isArray(e)&&e.length>4){let t=Memory.alloc(Process.pointerSize*e.length);return this.#t.enqueue(t),"pointer"}return e}).flat(),this.#e=t;let n;Array.isArray(t)?(this.#n=Process.pointerSize*t.length,this.#r=Memory.alloc(this.#n),t.length>4&&(n=this.#r)):t==="void"?this.#n=0:(this.#n=Process.pointerSize,this.#r=Memory.alloc(this.#n)),this.#s=Memory.alloc(Process.pointerSize*2);let r=76,o=Kt.allocateTrampoline(r);Memory.patchCode(o,r,t=>{let r=new Arm64Writer(t,{pc:o});if(r.putLdrRegAddress("x15",this.#s),r.putStpRegRegRegOffset("x29","x30","x15",0,"post-adjust"),i!==void 0&&r.putLdrRegAddress("x20",i),a!==void 0&&r.putLdrRegAddress("x21",a),n!==void 0&&r.putLdrRegAddress("x8",n),r.putLdrRegAddress("x14",e),r.putBlrRegNoAuth("x14"),n===void 0&&this.#n>0){r.putLdrRegAddress("x15",this.#r);let e=0,s=0;for(;s<this.#n;e++,s+=8){let t=`x${e}`;r.putStrRegRegOffset(t,"x15",s)}}r.putLdrRegAddress("x15",this.#s),r.putLdpRegRegRegOffset("x29","x30","x15",0,"post-adjust"),r.putRet(),r.flush()}),this.#i=new NativeFunction(o,"pointer",s)}wrapper=(...t)=>{this.#t.resetCursor(),t=t.map(e=>{if(Array.isArray(e)&&e.length>4){let t=this.#t.dequeue();return jt(e,t),t}return e}).flat();let e=this.#i;if(e(...t),this.#n===0)return;let r=[];if(!Array.isArray(this.#e))return this.#r.readValue(this.#e);for(let e=0,s=0;e<this.#n;e+=8,s++){let t=this.#e[s];r.push(this.#r.add(e).readValue(t))}return r};call(...t){return this.wrapper(t)}};function Jt(t){switch(t){case"pointer":return this.readPointer();case"string":return this.readCString();case"int":return this.readInt();case"uint":return this.readUInt();case"long":return this.readLong();case"ulong":return this.readULong();case"int8":return this.readS8();case"uint8":return this.readU8();case"int16":return this.readS16();case"uint16":return this.readU16();case"int32":return this.readS32();case"uint32":return this.readU32();case"int64":return this.readS64();case"uint64":return this.readU64();default:throw new Error(`Unimplemented type: ${t}`)}}NativePointer.prototype.readValue=Jt;var Yt=class ${handle;static SIZE=16;static OFFSETOF_NUMFIELDS=12;#t;constructor(t){this.handle=t}getFieldRecordBuffer(){return this.handle.add($.SIZE)}get numFields(){return this.#t!==void 0?this.#t:(this.#t=this.handle.add($.OFFSETOF_NUMFIELDS).readU32(),this.#t)}getFields(){let e=[],s=this.getFieldRecordBuffer(),r;for(let t=0;t<this.numFields;t++)r=new Xt(s),e.push(r),s=s.add(Xt.SIZE);return e}},Xt=class ${handle;static SIZE=12;static OFFSETOF_FLAGS=0;static OFFSETOF_MANGLED_TYPE_NAME=4;static OFFSETOF_FIELD_NAME=8;#t;#e;#n;constructor(t){this.handle=t}get flags(){return this.#t!==void 0?this.#t:(this.#t=this.handle.add($.OFFSETOF_FLAGS).readU32(),this.#t)}get mangledTypeName(){return this.#e!==void 0?this.#e:(this.#e=m.From(this.handle.add($.OFFSETOF_MANGLED_TYPE_NAME)),this.#e)}get fieldName(){return this.#n!==void 0?this.#n:(this.#n=m.From(this.handle.add($.OFFSETOF_FIELD_NAME)).get().readUtf8String(),this.#n)}get isIndirectCase(){return!!(this.flags&v.IsIndirectCase)}get isVar(){return!!(this.flags&v.IsVar)}},v;(function(t){t[t.IsIndirectCase=1]="IsIndirectCase",t[t.IsVar=2]="IsVar"})(v||(v={}));var b=class{kind;descriptor;$conformances;$name;$fields;$moduleName;constructor(t,e,s){this.kind=t,this.descriptor=e,this.$conformances=s,this.$name=e.name,this.$fields=ie(e),this.$moduleName=e.getModuleContext().name}get $metadataPointer(){return this.$metadata.handle}toJSON(){return{$fields:this.$fields,$conformances:Object.keys(this.$conformances)}}},Qt=class extends b{$methods;constructor(t,e){super("Class",t,e),this.$methods=ae(t);for(let r of this.$methods)if(r.type==="Init"){let s=Ft(r.name);if(s===void 0)continue;Object.defineProperty(this,s.jsSignature,{configurable:!0,get(){let t=s.argTypeNames.map(t=>y(t)),e=I(r.address,this.$metadata,t,this.$metadataPointer);return Object.defineProperty(this,s.jsSignature,{configurable:!0,value:e}),e}})}}get $metadata(){return w(this.descriptor.getFullTypeName(),F)}toJSON(){let t=super.toJSON();return Object.assign(t,{$methods:this.$methods})}},te=class extends b{constructor(t,e){super("Struct",t,e)}get $metadata(){return w(this.descriptor.getFullTypeName(),q)}},ee=class extends b{constructor(r,t){if(super("Enum",r,t),this.$fields!==void 0)for(let[t,s]of this.$fields.entries()){let e=t;if(r.isPayloadTag(e)){let t=t=>{if(t===void 0)throw new Error("Case requires an associated value");return new A(this.$metadata,{tag:e,payload:t})};Object.defineProperty(this,s.name,{configurable:!1,enumerable:!0,value:t,writable:!1})}else Object.defineProperty(this,s.name,{configurable:!0,enumerable:!0,get:()=>{let t=new A(this.$metadata,{tag:e});return Object.defineProperty(this,s.name,{value:t}),t}})}}get $metadata(){return w(this.descriptor.getFullTypeName(),J)}},se=class{descriptor;name;numRequirements;isClassOnly;moduleName;constructor(t){this.descriptor=t,this.name=t.name,this.numRequirements=t.numRequirements,this.isClassOnly=t.getProtocolContextDescriptorFlags().getClassConstraint()==V.Class,this.moduleName=t.getModuleContext().name}toJSON(){return{numRequirements:this.descriptor.numRequirements,isClassOnly:this.isClassOnly}}},N=class ${protocols;numProtocols;isClassOnly;constructor(...e){this.protocols=[...e],this.numProtocols=e.length,this.isClassOnly=!1;for(let t of e)if(t.isClassOnly){this.isClassOnly=!0;break}}get sizeofExistentialContainer(){return(this.isClassOnly?Process.pointerSize*1:Process.pointerSize*4)+Process.pointerSize*this.numProtocols}static fromSignature(t){let r=[],e=t.split("&").map(t=>t.trim());for(let s of e){let t=Pt(s),e=new se(t);r.push(e)}return new $(...r)}},re=class{equals(t){return this.handle.equals(t.handle)}toJSON(){return{handle:this.handle}}static fromAdopted(t,e){return e.getKind()===u.Class?new z(t):P.fromAdopted(t,e)}static fromExistentialContainer(r,i){if(i.isClassOnly){let t=wt.makeFromRaw(r,i.numProtocols);return new z(t.value)}else{let e=yt.makeFromRaw(r,i.numProtocols),s=e.type;if(s.isClassObject())return new z(e.buffer.privateData.readPointer());{let t=e.projectValue();return P.fromCopy(t,s)}}}},P=class extends re{$metadata;static fromCopy(t,e){let s=Memory.alloc(e.getTypeLayout().stride);return e.vw_initializeWithCopy(s,t),e.getKind()===u.Struct?new M(e,{handle:s}):new A(e,{handle:s})}static fromAdopted(t,e){let s=e.getKind();if(s===u.Struct)return new M(e,{handle:t});if(s===u.Enum)return new A(e,{handle:t});throw new Error("Non-value kind: "+s)}static fromRaw(t,e){let s=e.getKind();if(s===u.Struct)return new M(e,{raw:t});if(s===u.Enum)return new A(e,{raw:t});throw new Error("Non-value kind: "+s)}},M=class{$metadata;handle;constructor(t,e){if(e.handle===void 0&&e.raw===void 0)throw new Error("Either a handle or raw fields must be provided");this.$metadata=t instanceof te?t.$metadata:t,this.handle=e.handle||C(e.raw)}equals(t){return this.handle.equals(t.handle)}toJSON(){return{handle:this.handle}}},A=class{$metadata;handle;descriptor;#t;#e;constructor(t,i){this.$metadata=t instanceof ee?t.$metadata:t,this.descriptor=this.$metadata.getDescription();let a=ie(this.descriptor);if(i.tag===void 0&&i.handle===void 0&&i.raw===void 0)throw new Error("Either a tag, handle or raw fields must be provided");if(i.tag!==void 0){let e=i.tag,s=i.payload,t=this.$metadata.getTypeLayout().stride,r=t<Process.pointerSize?Process.pointerSize:t;if(this.handle=Memory.alloc(r),e===void 0||e>=this.descriptor.getNumCases())throw new Error("Invalid tag for an enum of this type");if(this.descriptor.isPayloadTag(e)){if(s===void 0)throw new Error("Payload must be provided for this tag");let t=a[e].typeName;if(s.$metadata.getFullTypeName()!==t)throw new Error("Payload must be of type "+t);s instanceof z?(this.handle.writePointer(s.handle),this.#e=s):(this.#e=P.fromAdopted(this.handle,s.$metadata),this.$metadata.vw_initializeWithCopy(this.handle,s.handle))}this.$metadata.vw_destructiveInjectEnumTag(this.handle,e),this.#t=e}else{this.handle=i.handle||C(i.raw);let s=this.$metadata.vw_getEnumTag(this.handle),r;if(s>=this.descriptor.getNumCases())throw new Error("Invalid pointer for an enum of this type");if(this.descriptor.isPayloadTag(s)){let t=a[s].typeName,e=w(t,p);r=re.fromAdopted(this.handle,e)}this.#t=s,this.#e=r}}get $tag(){return this.#t}get $payload(){return this.#e}equals(t){let e=!1;return this.$tag!==void 0&&t.$tag!==void 0&&(e=this.$tag===t.$tag),this.$payload!==void 0&&t.$payload!==void 0&&(e&&=this.$payload.handle.equals(t.$payload.handle)),e}toJSON(){return{handle:this.handle,$tag:this.#t,$payload:this.#e}}},z=class extends re{handle;$metadata;#t;constructor(t){super(),this.handle=t,this.#t=new B(t),this.$metadata=this.#t.getMetadata(F);let e=this.$metadata.getDescription();for(let i of ae(e))switch(i.type){case"Getter":{let t=St(i.name),e=y(t.memberTypeName),s=I(i.address,e,[],this.handle);Object.defineProperty(this,t.memberName,{configurable:!0,enumerable:!0,get:s});break}case"Setter":{let t=St(i.name),e=y(t.memberTypeName),s=I(i.address,"void",[e],this.handle);Object.defineProperty(this,t.memberName,{configurable:!0,enumerable:!0,set:s});break}case"Method":{let t=pt(i.name),e=t.retTypeName==="()"?"void":y(t.retTypeName),s=t.argTypeNames.map(t=>y(t)),r=I(i.address,e,s,this.handle);Object.defineProperty(this,t.jsSignature,{configurable:!0,enumerable:!0,value:r});break}}}};function ie(t){let e=[];if(!t.isReflectable())return;let s=new Yt(t.fields.get());if(s.numFields===0)return;let r=s.getFields();for(let t of r)e.push({name:t.fieldName,typeName:t.mangledTypeName===null?void 0:ne(t.mangledTypeName.get()),isVar:t.isVar});return e}function ae(t){let a=[];for(let i of t.getMethodDescriptors()){let t=i.impl.get(),e=Lt(t),s=i.flags.getKind(),r;switch(s){case c.Init:r="Init";break;case c.Getter:r="Getter";break;case c.Setter:r="Setter";break;case c.ReadCoroutine:r="ReadCoroutine";break;case c.ModifyCoroutine:r="ModifyCoroutine";break;case c.Method:r="Method";break;default:throw new Error(`Invalid method descriptor kind: ${s}`)}a.push({address:t,name:e,type:r})}return a}function ne(t){let e=t,s=e.readU8(),r=null;for(;s!==0;){if(s>=1&&s<=23){if(e=e.add(1),s===1)r=new S(m.From(e).get());else if(s===2){let t=m.From(e).get().readPointer();t=t.and(8796093022207),r=new S(t)}break}else if(s>=24&&s<=31)throw new Error("UNIMPLEMENTED 0x18 - 0x1F");e=e.add(1),s=e.readU8()}return r!==null?r.name:mt("_$s"+t.readCString())}var R=class ${static sharedInstance;modules={};classes={};structs={};enums={};protocols={};cachedTypes={};static shared(){return $.sharedInstance===void 0&&($.sharedInstance=new $),$.sharedInstance}constructor(){for(let t of It()){let e=t.descriptor,s=t.conformances;switch(t.descriptor.getKind()){case l.Class:{let t=new Qt(e,s);this.classes[t.$name]=t,this.getModule(t.$moduleName).addClass(t);break}case l.Struct:{let t=new te(e,s);this.structs[t.$name]=t,this.getModule(t.$moduleName).addStruct(t);break}case l.Enum:{let t=new ee(e,s);this.enums[t.$name]=t,this.getModule(t.$moduleName).addEnum(t);break}}}for(let e of bt()){let t=new se(e);this.protocols[e.name]=t,this.getModule(t.moduleName).addProtocol(t)}}getModule(t){if(t in this.modules)return this.modules[t];let e=new oe(t);return this.modules[t]=e,e}},oe=class{name;classes={};structs={};enums={};protocols={};constructor(t){this.name=t}addClass(t){this.classes[t.$name]=t}addStruct(t){this.structs[t.$name]=t}addEnum(t){this.enums[t.$name]=t}addProtocol(t){this.protocols[t.name]=t}toJSON(){return{classes:Object.keys(this.classes).length,structs:Object.keys(this.structs).length,enums:Object.keys(this.enums).length,protocols:Object.keys(this.protocols).length}}};var le;(function(t){function e(t,r){let e=kt(t),i=pt(e),n,s=function(o){if(n=this.context[Wt],r.onEnter!==void 0){let s=[],a=0,n;for(let e of i.argTypeNames){if(de(e)){let t=N.fromSignature(e),r=t.sizeofExistentialContainer,i;if(r<=Vt){let t=_(r),e=a+t,s=ue(o,a,e);i=C(s),a+=t}else i=o[a++];n=P.fromExistentialContainer(i,t),s.push(n);continue}let i=y(e);if(i.isClassObject())n=new z(o[a++]);else{let t=_(i.getTypeLayout().stride),e=i.getKind(),s=a+t,r=ue(o,a,s);if(e===u.Struct){let t=i;n=new M(t,{raw:r})}else if(e===u.Enum){let t=i;n=new A(t,{raw:r})}else throw new Error("Unhandled metadata kind: "+e);a+=t}s.push(n)}r.onEnter.bind(this)(s)}},a;return r.onLeave!==void 0&&(a=function(e){let s=i.retTypeName,a;if(de(s)){let t=N.fromSignature(s),r=t.sizeofExistentialContainer,i;if(r<=Vt){let e=_(r),s=[];for(let t=0;t!=e;t++)s.push(this.context[`x${t}`]);i=C(s)}else i=n;a=P.fromExistentialContainer(i,t)}else{let t=y(i.retTypeName);if(t.isClassObject())a=new z(e);else if(t.getTypeLayout().stride<=Vt&&!Ht(t)){let e=_(t.getTypeLayout().stride),s=[];for(let t=0;t<e;t++)s.push(this.context[`x${t}`]);a=P.fromRaw(s,t)}else a=P.fromCopy(n,t)}r.onLeave.bind(this)(a)}),Interceptor.attach(t,{onEnter:s,onLeave:a})}t.attach=e})(le||(le={}));function de(t){return t.indexOf("&")>-1||Nt(t)}function ue(e,s,r){let i=[];for(let t=s;t!=r;t++)i.push(e[t]);return i}var ce=class{#t=null;#e=null;constructor(){try{this.tryInitialize()}catch{}}get available(){try{return this.tryInitialize()}catch{return!1}}get api(){return this.#t}get modules(){return R.shared().modules}get classes(){return R.shared().classes}get structs(){return R.shared().structs}get enums(){return R.shared().enums}get protocols(){return R.shared().protocols}Object=z;Struct=M;Enum=A;ProtocolComposition=N;Interceptor=le;NativeFunction(t,e,s,r,i){function a(t){return t instanceof b?t.$metadata:t instanceof se?new N(t):t}let n=a(e),o=s.map(t=>a(t));return I(t,n,o,r,i)}tryInitialize(){if(this.#t!==null)return!0;if(this.#e!==null)throw this.#e;try{this.#t=i(),d(),Tt()}catch(t){throw this.#e=t,t}return this.#t!==null}},he=new ce;Object.defineProperty(globalThis,"Swift",{value:he})})();