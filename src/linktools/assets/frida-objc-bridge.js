(()=>{var F=null,R={exceptions:"propagate"};function H(){if(F!==null)return F;let s={},e=[{module:"libsystem_malloc.dylib",functions:{free:["void",["pointer"]]}},{module:"libobjc.A.dylib",functions:{objc_msgSend:function(e){this.objc_msgSend=e},objc_msgSend_stret:function(e){this.objc_msgSend_stret=e},objc_msgSend_fpret:function(e){this.objc_msgSend_fpret=e},objc_msgSendSuper:function(e){this.objc_msgSendSuper=e},objc_msgSendSuper_stret:function(e){this.objc_msgSendSuper_stret=e},objc_msgSendSuper_fpret:function(e){this.objc_msgSendSuper_fpret=e},objc_getClassList:["int",["pointer","int"]],objc_lookUpClass:["pointer",["pointer"]],objc_allocateClassPair:["pointer",["pointer","pointer","pointer"]],objc_disposeClassPair:["void",["pointer"]],objc_registerClassPair:["void",["pointer"]],class_isMetaClass:["bool",["pointer"]],class_getName:["pointer",["pointer"]],class_getImageName:["pointer",["pointer"]],class_copyProtocolList:["pointer",["pointer","pointer"]],class_copyMethodList:["pointer",["pointer","pointer"]],class_getClassMethod:["pointer",["pointer","pointer"]],class_getInstanceMethod:["pointer",["pointer","pointer"]],class_getSuperclass:["pointer",["pointer"]],class_addProtocol:["bool",["pointer","pointer"]],class_addMethod:["bool",["pointer","pointer","pointer","pointer"]],class_copyIvarList:["pointer",["pointer","pointer"]],objc_getProtocol:["pointer",["pointer"]],objc_copyProtocolList:["pointer",["pointer"]],objc_allocateProtocol:["pointer",["pointer"]],objc_registerProtocol:["void",["pointer"]],protocol_getName:["pointer",["pointer"]],protocol_copyMethodDescriptionList:["pointer",["pointer","bool","bool","pointer"]],protocol_copyPropertyList:["pointer",["pointer","pointer"]],protocol_copyProtocolList:["pointer",["pointer","pointer"]],protocol_addProtocol:["void",["pointer","pointer"]],protocol_addMethodDescription:["void",["pointer","pointer","pointer","bool","bool"]],ivar_getName:["pointer",["pointer"]],ivar_getTypeEncoding:["pointer",["pointer"]],ivar_getOffset:["pointer",["pointer"]],object_isClass:["bool",["pointer"]],object_getClass:["pointer",["pointer"]],object_getClassName:["pointer",["pointer"]],method_getName:["pointer",["pointer"]],method_getTypeEncoding:["pointer",["pointer"]],method_getImplementation:["pointer",["pointer"]],method_setImplementation:["pointer",["pointer","pointer"]],property_getName:["pointer",["pointer"]],property_copyAttributeList:["pointer",["pointer","pointer"]],sel_getName:["pointer",["pointer"]],sel_registerName:["pointer",["pointer"]],class_getInstanceSize:["pointer",["pointer"]]},optionals:{objc_msgSend_stret:"ABI",objc_msgSend_fpret:"ABI",objc_msgSendSuper_stret:"ABI",objc_msgSendSuper_fpret:"ABI",object_isClass:"iOS8"}},{module:"libdispatch.dylib",functions:{dispatch_async_f:["void",["pointer","pointer","pointer"]]},variables:{_dispatch_main_q:function(e){this._dispatch_main_q=e}}}],l=0;return e.forEach(function(e){let n=e.module==="libobjc.A.dylib",o=e.functions||{},r=e.variables||{},i=e.optionals||{};l+=Object.keys(o).length+Object.keys(r).length;let a=(Process.findModuleByName(e.module)?.enumerateExports()??[]).reduce(function(e,t){return e[t.name]=t,e},{});Object.keys(o).forEach(function(t){let r=a[t];if(r!==void 0&&r.type==="function"){let e=o[t];typeof e=="function"?(e.call(s,r.address),n&&e.call(s,r.address)):(s[t]=new NativeFunction(r.address,e[0],e[1],R),n&&(s[t]=s[t])),l--}else i[t]&&l--}),Object.keys(r).forEach(function(e){let t=a[e];t!==void 0&&t.type==="variable"&&(r[e].call(s,t.address),l--)})}),l===0&&(s.objc_msgSend_stret||(s.objc_msgSend_stret=s.objc_msgSend),s.objc_msgSend_fpret||(s.objc_msgSend_fpret=s.objc_msgSend),s.objc_msgSendSuper_stret||(s.objc_msgSendSuper_stret=s.objc_msgSendSuper),s.objc_msgSendSuper_fpret||(s.objc_msgSendSuper_fpret=s.objc_msgSendSuper),F=s),F}var se=`#include <glib.h>
#include <ptrauth.h>

#define KERN_SUCCESS 0
#define MALLOC_PTR_IN_USE_RANGE_TYPE 1
#if defined (HAVE_I386) && GLIB_SIZEOF_VOID_P == 8
# define OBJC_ISA_MASK 0x7ffffffffff8ULL
#elif defined (HAVE_ARM64)
# define OBJC_ISA_MASK 0xffffffff8ULL
#endif

typedef struct _ChooseContext ChooseContext;

typedef struct _malloc_zone_t malloc_zone_t;
typedef struct _malloc_introspection_t malloc_introspection_t;
typedef struct _vm_range_t vm_range_t;

typedef gpointer Class;
typedef int kern_return_t;
typedef guint mach_port_t;
typedef mach_port_t task_t;
typedef guintptr vm_offset_t;
typedef guintptr vm_size_t;
typedef vm_offset_t vm_address_t;

struct _ChooseContext
{
  GHashTable * classes;
  GArray * matches;
};

struct _malloc_zone_t
{
  void * reserved1;
  void * reserved2;
  size_t (* size) (struct _malloc_zone_t * zone, const void * ptr);
  void * (* malloc) (struct _malloc_zone_t * zone, size_t size);
  void * (* calloc) (struct _malloc_zone_t * zone, size_t num_items, size_t size);
  void * (* valloc) (struct _malloc_zone_t * zone, size_t size);
  void (* free) (struct _malloc_zone_t * zone, void * ptr);
  void * (* realloc) (struct _malloc_zone_t * zone, void * ptr, size_t size);
  void (* destroy) (struct _malloc_zone_t * zone);
  const char * zone_name;

  unsigned (* batch_malloc) (struct _malloc_zone_t * zone, size_t size, void ** results, unsigned num_requested);
  void (* batch_free) (struct _malloc_zone_t * zone, void ** to_be_freed, unsigned num_to_be_freed);

  malloc_introspection_t * introspect;
};

typedef kern_return_t (* memory_reader_t) (task_t remote_task, vm_address_t remote_address, vm_size_t size, void ** local_memory);
typedef void (* vm_range_recorder_t) (task_t task, void * user_data, unsigned type, vm_range_t * ranges, unsigned count);
typedef kern_return_t (* enumerator_func) (task_t task, void * user_data, unsigned type_mask, vm_address_t zone_address, memory_reader_t reader,
      vm_range_recorder_t recorder);

struct _malloc_introspection_t
{
  enumerator_func enumerator;
};

struct _vm_range_t
{
  vm_address_t address;
  vm_size_t size;
};

extern int objc_getClassList (Class * buffer, int buffer_count);
extern Class class_getSuperclass (Class cls);
extern size_t class_getInstanceSize (Class cls);
extern kern_return_t malloc_get_all_zones (task_t task, memory_reader_t reader, vm_address_t ** addresses, unsigned * count);

static void collect_subclasses (Class klass, GHashTable * result);
static void collect_matches_in_ranges (task_t task, void * user_data, unsigned type, vm_range_t * ranges, unsigned count);
static kern_return_t read_local_memory (task_t remote_task, vm_address_t remote_address, vm_size_t size, void ** local_memory);

extern mach_port_t selfTask;

gpointer *
choose (Class * klass,
        gboolean consider_subclasses,
        guint * count)
{
  ChooseContext ctx;
  GHashTable * classes;
  vm_address_t * malloc_zone_addresses;
  unsigned malloc_zone_count, i;

  classes = g_hash_table_new_full (NULL, NULL, NULL, NULL);
  ctx.classes = classes;
  ctx.matches = g_array_new (FALSE, FALSE, sizeof (gpointer));
  if (consider_subclasses)
    collect_subclasses (klass, classes);
  else
    g_hash_table_insert (classes, klass, GSIZE_TO_POINTER (class_getInstanceSize (klass)));

  malloc_zone_count = 0;
  malloc_get_all_zones (selfTask, read_local_memory, &malloc_zone_addresses, &malloc_zone_count);

  for (i = 0; i != malloc_zone_count; i++)
  {
    vm_address_t zone_address = malloc_zone_addresses[i];
    malloc_zone_t * zone = (malloc_zone_t *) zone_address;
    enumerator_func enumerator;

    if (zone != NULL && zone->introspect != NULL &&
        (enumerator = (ptrauth_strip (zone->introspect, ptrauth_key_asda))->enumerator) != NULL)
    {
      enumerator = ptrauth_sign_unauthenticated (
          ptrauth_strip (enumerator, ptrauth_key_asia),
          ptrauth_key_asia, 0);

      enumerator (selfTask, &ctx, MALLOC_PTR_IN_USE_RANGE_TYPE, zone_address, read_local_memory,
          collect_matches_in_ranges);
    }
  }

  g_hash_table_unref (classes);

  *count = ctx.matches->len;

  return (gpointer *) g_array_free (ctx.matches, FALSE);
}

void
destroy (gpointer mem)
{
  g_free (mem);
}

static void
collect_subclasses (Class klass,
                    GHashTable * result)
{
  Class * classes;
  int count, i;

  count = objc_getClassList (NULL, 0);
  classes = g_malloc (count * sizeof (gpointer));
  count = objc_getClassList (classes, count);

  for (i = 0; i != count; i++)
  {
    Class candidate = classes[i];
    Class c;

    c = candidate;
    do
    {
      if (c == klass)
      {
        g_hash_table_insert (result, candidate, GSIZE_TO_POINTER (class_getInstanceSize (candidate)));
        break;
      }

      c = class_getSuperclass (c);
    }
    while (c != NULL);
  }

  g_free (classes);
}

static void
collect_matches_in_ranges (task_t task,
                           void * user_data,
                           unsigned type,
                           vm_range_t * ranges,
                           unsigned count)
{
  ChooseContext * ctx = user_data;
  GHashTable * classes = ctx->classes;
  unsigned i;

  for (i = 0; i != count; i++)
  {
    const vm_range_t * range = &ranges[i];
    gconstpointer candidate = GSIZE_TO_POINTER (range->address);
    gconstpointer isa;
    guint instance_size;

    isa = *(gconstpointer *) candidate;
#ifdef OBJC_ISA_MASK
    isa = GSIZE_TO_POINTER (GPOINTER_TO_SIZE (isa) & OBJC_ISA_MASK);
#endif

    instance_size = GPOINTER_TO_UINT (g_hash_table_lookup (classes, isa));
    if (instance_size != 0 && range->size >= instance_size)
    {
      g_array_append_val (ctx->matches, candidate);
    }
  }
}

static kern_return_t
read_local_memory (task_t remote_task,
                   vm_address_t remote_address,
                   vm_size_t size,
                   void ** local_memory)
{
  *local_memory = (void *) remote_address;

  return KERN_SUCCESS;
}
`,{pointerSize:ie}=Process,W=null;function ee(){return W===null&&(W=ae()),W}function ae(){let{objc_getClassList:e,class_getSuperclass:t,class_getInstanceSize:r}=H(),n=Memory.alloc(4);n.writeU32(Module.getGlobalExportByName("mach_task_self_").readU32());let o=new CModule(se,{objc_getClassList:e,class_getSuperclass:t,class_getInstanceSize:r,malloc_get_all_zones:Process.getModuleByName("/usr/lib/system/libsystem_malloc.dylib").getExportByName("malloc_get_all_zones"),selfTask:n}),i=new NativeFunction(o.choose,"pointer",["pointer","bool","pointer"]),a=new NativeFunction(o.destroy,"void",["pointer"]);return{handle:o,choose(e,t){let r=[],n=Memory.alloc(4),o=i(e,t?1:0,n);try{let t=n.readU32();for(let e=0;e!==t;e++)r.push(o.add(e*ie).readPointer())}finally{a(o)}return r}}}function ce(){let pointerSize=Process.pointerSize,api=null,apiError=null,realizedClasses=new Set,classRegistry=new ClassRegistry,protocolRegistry=new ProtocolRegistry,replacedMethods=new Map,scheduledWork=new Map,nextId=1,workCallback=null,NSAutoreleasePool=null,bindings=new Map,readObjectIsa=null,msgSendBySignatureId=new Map,msgSendSuperBySignatureId=new Map,cachedNSString=null,cachedNSStringCtor=null,cachedNSNumber=null,cachedNSNumberCtor=null,singularTypeById=null,modifiers=null;try{tryInitialize()}catch(e){}function tryInitialize(){if(api!==null)return!0;if(apiError!==null)throw apiError;try{api=H()}catch(e){throw apiError=e,e}return api!==null}function dispose(){for(let[n,o]of replacedMethods.entries()){let e=ptr(n),[t,r]=o;api.method_getImplementation(e).equals(r)&&api.method_setImplementation(e,t)}replacedMethods.clear()}Script.bindWeak(this,dispose),Object.defineProperty(this,"available",{enumerable:!0,get(){return tryInitialize()}}),Object.defineProperty(this,"api",{enumerable:!0,get(){return H()}}),Object.defineProperty(this,"classes",{enumerable:!0,value:classRegistry}),Object.defineProperty(this,"protocols",{enumerable:!0,value:protocolRegistry}),Object.defineProperty(this,"Object",{enumerable:!0,value:ObjCObject}),Object.defineProperty(this,"Protocol",{enumerable:!0,value:ObjCProtocol}),Object.defineProperty(this,"Block",{enumerable:!0,value:Block}),Object.defineProperty(this,"mainQueue",{enumerable:!0,get(){return api?._dispatch_main_q??null}}),Object.defineProperty(this,"registerProxy",{enumerable:!0,value:registerProxy}),Object.defineProperty(this,"registerClass",{enumerable:!0,value:registerClass}),Object.defineProperty(this,"registerProtocol",{enumerable:!0,value:registerProtocol}),Object.defineProperty(this,"bind",{enumerable:!0,value:bind}),Object.defineProperty(this,"unbind",{enumerable:!0,value:unbind}),Object.defineProperty(this,"getBoundData",{enumerable:!0,value:getBoundData}),Object.defineProperty(this,"enumerateLoadedClasses",{enumerable:!0,value:enumerateLoadedClasses}),Object.defineProperty(this,"enumerateLoadedClassesSync",{enumerable:!0,value:enumerateLoadedClassesSync}),Object.defineProperty(this,"choose",{enumerable:!0,value:choose}),Object.defineProperty(this,"chooseSync",{enumerable:!0,value(e){let t=[];return choose(e,{onMatch(e){t.push(e)},onComplete(){}}),t}}),this.schedule=function(e,t){let r=ptr(nextId++);scheduledWork.set(r.toString(),t),workCallback===null&&(workCallback=new NativeCallback(performScheduledWorkItem,"void",["pointer"])),Script.pin(),api.dispatch_async_f(e,r,workCallback)};function performScheduledWorkItem(e){let t=e.toString(),r=scheduledWork.get(t);scheduledWork.delete(t),NSAutoreleasePool===null&&(NSAutoreleasePool=classRegistry.NSAutoreleasePool);let n=NSAutoreleasePool.alloc().init(),o=null;try{r()}catch(e){o=e}n.release(),setImmediate(performScheduledWorkCleanup,o)}function performScheduledWorkCleanup(e){if(Script.unpin(),e!==null)throw e}this.implement=function(e,t){return new NativeCallback(t,e.returnType,e.argumentTypes)},this.selector=selector,this.selectorAsString=selectorAsString;function selector(e){return api.sel_registerName(Memory.allocUtf8String(e))}function selectorAsString(e){return api.sel_getName(e).readUtf8String()}let registryBuiltins=new Set(["prototype","constructor","hasOwnProperty","toJSON","toString","valueOf"]);function ClassRegistry(){let o={},r=0,e=new Proxy(this,{has(e,t){return n(t)},get(t,r,e){switch(r){case"prototype":return t.prototype;case"constructor":return t.constructor;case"hasOwnProperty":return n;case"toJSON":return s;case"toString":return l;case"valueOf":return c;default:let e=a(r);return e!==null?e:void 0}},set(e,t,r,n){return!1},ownKeys(e){if(api===null)return[];let t=api.objc_getClassList(NULL,0);if(t!==r){let n=Memory.alloc(t*pointerSize);t=api.objc_getClassList(n,t);for(let r=0;r!==t;r++){let e=n.add(r*pointerSize).readPointer(),t=api.class_getName(e).readUtf8String();o[t]=e}r=t}return Object.keys(o)},getOwnPropertyDescriptor(e,t){return{writable:!1,configurable:!0,enumerable:!0}}});function n(e){return registryBuiltins.has(e)?!0:a(e)!==null}function i(e){let t=a(e);if(t===null)throw new Error("Unable to find class '"+e+"'");return t}function a(e){let t=o[e];if(t===void 0){if(t=api.objc_lookUpClass(Memory.allocUtf8String(e)),t.isNull())return null;o[e]=t,r++}return new ObjCObject(t,void 0,!0)}function s(){return Object.keys(e).reduce(function(e,t){return e[t]=i(t).toJSON(),e},{})}function l(){return"ClassRegistry"}function c(){return"ClassRegistry"}return e}function ProtocolRegistry(){let o={},r=0,e=new Proxy(this,{has(e,t){return n(t)},get(t,r,e){switch(r){case"prototype":return t.prototype;case"constructor":return t.constructor;case"hasOwnProperty":return n;case"toJSON":return a;case"toString":return s;case"valueOf":return l;default:let e=i(r);return e!==null?e:void 0}},set(e,t,r,n){return!1},ownKeys(e){if(api===null)return[];let t=Memory.alloc(pointerSize),n=api.objc_copyProtocolList(t);try{let e=t.readUInt();if(e!==r){o={};for(let r=0;r!==e;r++){let e=n.add(r*pointerSize).readPointer(),t=api.protocol_getName(e).readUtf8String();o[t]=e}r=e}}finally{api.free(n)}return Object.keys(o)},getOwnPropertyDescriptor(e,t){return{writable:!1,configurable:!0,enumerable:!0}}});function n(e){return registryBuiltins.has(e)?!0:i(e)!==null}function i(e){let t=o[e];if(t===void 0){if(t=api.objc_getProtocol(Memory.allocUtf8String(e)),t.isNull())return null;o[e]=t,r++}return new ObjCProtocol(t)}function a(){return Object.keys(e).reduce(function(e,t){return e[t]={handle:o[t]},e},{})}function s(){return"ProtocolRegistry"}function l(){return"ProtocolRegistry"}return e}let objCObjectBuiltins=new Set(["prototype","constructor","handle","hasOwnProperty","toJSON","toString","valueOf","equals","$kind","$super","$superClass","$class","$className","$moduleName","$protocols","$methods","$ownMethods","$ivars"]);function ObjCObject(i,u,a,s){let e=null,l=null,c=null,p=null,d=null,f=null,m=null,g=null,n=null,r=null,_=null,h={},y=null,b=null,S=null;if(i=getHandle(i),a===void 0){let e=api.object_getClass(i),t=e.toString();realizedClasses.has(t)||(api.objc_lookUpClass(api.class_getName(e)),realizedClasses.add(t))}let v=new Proxy(this,{has(e,t){return C(t)},get(r,n,o){switch(n){case"handle":return i;case"prototype":return r.prototype;case"constructor":return r.constructor;case"hasOwnProperty":return C;case"toJSON":return I;case"toString":case"valueOf":let t=o.description;if(t!==void 0){let e=t.call(o);if(e!==null)return e.UTF8String.bind(e)}return function(){return o.$className};case"equals":return M;case"$kind":return l===null&&(w()?l=api.class_isMetaClass(i)?"meta-class":"class":l="instance"),l;case"$super":if(c===null){let t=api.class_getSuperclass(N());if(t.isNull())c=[null];else{let e=Memory.alloc(2*pointerSize);e.writePointer(i),e.add(pointerSize).writePointer(t),c=[new ObjCObject(i,void 0,a,e)]}}return c[0];case"$superClass":if(p===null){let e=api.class_getSuperclass(N());e.isNull()?p=[null]:p=[new ObjCObject(e)]}return p[0];case"$class":return d===null&&(d=new ObjCObject(api.object_getClass(i),void 0,!0)),d;case"$className":return f===null&&(s?f=api.class_getName(s.add(pointerSize).readPointer()).readUtf8String():w()?f=api.class_getName(i).readUtf8String():f=api.object_getClassName(i).readUtf8String()),f;case"$moduleName":return m===null&&(m=api.class_getImageName(N()).readUtf8String()),m;case"$protocols":if(g===null){g={};let t=Memory.alloc(pointerSize),n=api.class_copyProtocolList(N(),t);if(!n.isNull())try{let e=t.readUInt();for(let r=0;r!==e;r++){let e=n.add(r*pointerSize).readPointer(),t=new ObjCProtocol(e);g[t.name]=t}}finally{api.free(n)}}return g;case"$methods":if(y===null){let e=s?s.add(pointerSize).readPointer():N(),t=api.object_getClass(e),r=new Set,n=t;do{for(let e of collectMethodNames(n,"+ "))r.add(e);n=api.class_getSuperclass(n)}while(!n.isNull());n=e;do{for(let e of collectMethodNames(n,"- "))r.add(e);n=api.class_getSuperclass(n)}while(!n.isNull());y=Array.from(r)}return y;case"$ownMethods":if(b===null){let e=s?s.add(pointerSize).readPointer():N(),t=api.object_getClass(e),r=collectMethodNames(t,"+ "),n=collectMethodNames(e,"- ");b=r.concat(n)}return b;case"$ivars":return S===null&&(w()?S={}:S=new ObjCIvars(v,N())),S;default:if(typeof n=="symbol")return r[n];if(u){let e=j(n);if(e===null||!e.implemented)return}let e=z(n);return e===null?void 0:e}},set(e,t,r,n){return!1},ownKeys(e){if(n===null)if(u){let t=[],r=P();Object.keys(r).forEach(function(e){e[0]!=="+"&&e[0]!=="-"&&r[e].implemented&&t.push(e)}),n=t}else{let u={},p={},e=api.object_getClass(i);do{let t=Memory.alloc(pointerSize),l=api.class_copyMethodList(e,t),c=w()?"+ ":"- ";try{let e=t.readUInt();for(let s=0;s!==e;s++){let t=l.add(s*pointerSize).readPointer(),r=api.method_getName(t),e=api.sel_getName(r).readUtf8String();if(p[e]!==void 0)continue;p[e]=e;let n=jsMethodName(e),o=2,i=n;for(;u[i]!==void 0;)o++,i=n+o;u[i]=!0;let a=c+e;if(h[a]===void 0){let e={sel:r,handle:t,wrapper:null};h[a]=e,h[i]=e}}}finally{api.free(l)}e=api.class_getSuperclass(e)}while(!e.isNull());n=Object.keys(u)}return["handle"].concat(n)},getOwnPropertyDescriptor(e,t){return{writable:!1,configurable:!0,enumerable:!0}}});return u&&(_=w()?null:z("- respondsToSelector:")),v;function C(t){if(objCObjectBuiltins.has(t))return!0;if(u){let e=j(t);return!!(e!==null&&e.implemented)}return o(t)!==null}function N(){return e===null&&(e=w()?i:api.object_getClass(i)),e}function w(){return a===void 0&&(api.object_isClass?a=!!api.object_isClass(i):a=!!api.class_isMetaClass(api.object_getClass(i))),a}function o(e){let n=h[e];if(n!==void 0)return n;let t=T(e),o=t[2];if(n=h[o],n!==void 0)return h[e]=n,n;let i=t[0],a=t[1],s=selector(a),r=w()?"+":"-";if(u){let e=j(o);e!==null&&(n={sel:s,types:e.types,wrapper:null,kind:i})}if(n===void 0){let e=i==="+"?api.class_getClassMethod(N(),s):api.class_getInstanceMethod(N(),s);if(!e.isNull())n={sel:s,handle:e,wrapper:null,kind:i};else{if(w()||i!=="-"||a==="forwardingTargetForSelector:"||a==="methodSignatureForSelector:")return null;let t=v;if("- forwardingTargetForSelector:"in v){let e=v.forwardingTargetForSelector_(s);if(e!==null&&e.$kind==="instance")t=e;else return null}else return null;let e=api.class_getInstanceMethod(api.object_getClass(t.handle),s);if(e.isNull())return null;let r=api.method_getTypeEncoding(e).readUtf8String();if((r===null||r==="")&&(r=k(t,o),r===null&&(r=k(v,o)),r===null))return null;n={sel:s,types:r,wrapper:null,kind:i}}}return h[o]=n,h[e]=n,i===r&&(h[jsMethodName(a)]=n),n}function k(t,e){let r=Object.keys(t.$protocols).map(e=>O({},t.$protocols[e])).reduce((e,t)=>(Object.assign(e,t),e),{})[e];return r===void 0?null:r.types}function O(e,t){return t.methods!==void 0&&Object.assign(e,t.methods),t.protocol!==void 0&&O(e,t.protocol),e}function j(e){let t=P()[e];return t!==void 0?t:null}function P(){if(r===null){let l={},t=collectProtocols(u),c=w()?"+":"-";Object.keys(t).forEach(function(e){let s=t[e].methods;Object.keys(s).forEach(function(e){let t=s[e],r=e.substr(2),n=e[0],o=!1,i=!1,a={types:t.types};Object.defineProperty(a,"implemented",{get(){return o||(t.required?i=!0:i=_!==null&&_.call(v,selector(r)),o=!0),i}}),l[e]=a,n===c&&(l[jsMethodName(r)]=a)})}),r=l}return r}function z(e){let t=o(e);if(t===null)return null;let r=t.wrapper;return r===null&&(r=makeMethodInvocationWrapper(t,v,s,R),t.wrapper=r),r}function T(e){let t=/([+\-])\s(\S+)/.exec(e),r,n;t===null?(n=w()?"+":"-",r=objcMethodName(e)):(n=t[1],r=t[2]);let o=[n,r].join(" ");return[n,r,o]}function I(){return{handle:i.toString()}}function M(e){return i.equals(getHandle(e))}}function getReplacementMethodImplementation(e){let t=replacedMethods.get(e.toString());if(t===void 0)return null;let[,r]=t;return r}function replaceMethodImplementation(e,t){let r=e.toString(),n,o=replacedMethods.get(r);o!==void 0?[n]=o:n=api.method_getImplementation(e),t.equals(n)?replacedMethods.delete(r):replacedMethods.set(r,[n,t]),api.method_setImplementation(e,t)}function collectMethodNames(e,o){let i=[],t=Memory.alloc(pointerSize),a=api.class_copyMethodList(e,t);try{let e=t.readUInt();for(let n=0;n!==e;n++){let e=a.add(n*pointerSize).readPointer(),t=api.method_getName(e),r=api.sel_getName(t).readUtf8String();i.push(o+r)}}finally{api.free(a)}return i}function ObjCProtocol(e){let t=null,o=null,s=null,r=null;Object.defineProperty(this,"handle",{value:e,enumerable:!0}),Object.defineProperty(this,"name",{get(){return t===null&&(t=api.protocol_getName(e).readUtf8String()),t},enumerable:!0}),Object.defineProperty(this,"protocols",{get(){if(o===null){o={};let t=Memory.alloc(pointerSize),n=api.protocol_copyProtocolList(e,t);if(!n.isNull())try{let e=t.readUInt();for(let r=0;r!==e;r++){let e=n.add(r*pointerSize).readPointer(),t=new ObjCProtocol(e);o[t.name]=t}}finally{api.free(n)}}return o},enumerable:!0}),Object.defineProperty(this,"properties",{get(){if(s===null){s={};let n=Memory.alloc(pointerSize),a=api.protocol_copyPropertyList(e,n);if(!a.isNull())try{let e=n.readUInt();for(let r=0;r!==e;r++){let e=a.add(r*pointerSize).readPointer(),t=api.property_getName(e).readUtf8String(),o={},i=api.property_copyAttributeList(e,n);if(!i.isNull())try{let e=n.readUInt();for(let n=0;n!==e;n++){let e=i.add(n*(2*pointerSize)),t=e.readPointer().readUtf8String(),r=e.add(pointerSize).readPointer().readUtf8String();o[t]=r}}finally{api.free(i)}s[t]=o}}finally{api.free(a)}}return s},enumerable:!0}),Object.defineProperty(this,"methods",{get(){if(r===null){r={};let e=Memory.alloc(pointerSize);n(r,e,{required:!0,instance:!1}),n(r,e,{required:!1,instance:!1}),n(r,e,{required:!0,instance:!0}),n(r,e,{required:!1,instance:!0})}return r},enumerable:!0});function n(o,t,i){let a=api.protocol_copyMethodDescriptionList(e,i.required?1:0,i.instance?1:0,t);if(!a.isNull())try{let e=t.readUInt();for(let n=0;n!==e;n++){let e=a.add(n*(2*pointerSize)),t=(i.instance?"- ":"+ ")+selectorAsString(e.readPointer()),r=e.add(pointerSize).readPointer().readUtf8String();o[t]={required:i.required,types:r}}}finally{api.free(a)}}}let objCIvarsBuiltins=new Set(["prototype","constructor","hasOwnProperty","toJSON","toString","valueOf"]);function ObjCIvars(p,e){let o={},t=null,r=[],n=e;do{r.unshift(n),n=api.class_getSuperclass(n)}while(!n.isNull());let i=Memory.alloc(pointerSize);r.forEach(e=>{let n=api.class_copyIvarList(e,i);try{let e=i.readUInt();for(let r=0;r!==e;r++){let e=n.add(r*pointerSize).readPointer(),t=api.ivar_getName(e).readUtf8String();o[t]=[e,null]}}finally{api.free(n)}});let a=new Proxy(this,{has(e,t){return l(t)},get(t,r,e){switch(r){case"prototype":return t.prototype;case"constructor":return t.constructor;case"hasOwnProperty":return l;case"toJSON":return c;case"toString":return u;case"valueOf":return d;default:let e=s(r);return e===null?void 0:e.get()}},set(e,t,r,n){let o=s(t);if(o===null)throw new Error("Unknown ivar");return o.set(r),!0},ownKeys(e){return t===null&&(t=Object.keys(o)),t},getOwnPropertyDescriptor(e,t){return{writable:!0,configurable:!0,enumerable:!0}}});return a;function s(l){let c=o[l];if(c===void 0)return null;let u=c[1];if(u===null){let e=c[0],t=api.ivar_getOffset(e).toInt32(),r=p.handle.add(t),n=parseType(api.ivar_getTypeEncoding(e).readUtf8String()),o=n.fromNative||identityTransform,i=n.toNative||identityTransform,a,s;l==="isa"?(a=readObjectIsa,s=function(){throw new Error("Unable to set the isa instance variable")}):(a=n.read,s=n.write),u={get(){return o.call(p,a(r))},set(e){s(r,i.call(p,e))}},c[1]=u}return u}function l(e){return objCIvarsBuiltins.has(e)?!0:o.hasOwnProperty(e)}function c(){return Object.keys(a).reduce(function(e,t){return e[t]=a[t],e},{})}function u(){return"ObjCIvars"}function d(){return"ObjCIvars"}}let blockDescriptorAllocSize,blockDescriptorDeclaredSize,blockDescriptorOffsets,blockSize,blockOffsets;pointerSize===4?(blockDescriptorAllocSize=16,blockDescriptorDeclaredSize=20,blockDescriptorOffsets={reserved:0,size:4,rest:8},blockSize=20,blockOffsets={isa:0,flags:4,reserved:8,invoke:12,descriptor:16}):(blockDescriptorAllocSize=32,blockDescriptorDeclaredSize=32,blockDescriptorOffsets={reserved:0,size:8,rest:16},blockSize=32,blockOffsets={isa:0,flags:8,reserved:12,invoke:16,descriptor:24});let BLOCK_HAS_COPY_DISPOSE=1<<25,BLOCK_HAS_CTOR=1<<26,BLOCK_IS_GLOBAL=1<<28,BLOCK_HAS_STRET=1<<29,BLOCK_HAS_SIGNATURE=1<<30;function Block(n,e=R){if(this._options=e,n instanceof NativePointer){let t=n.add(blockOffsets.descriptor).readPointer();this.handle=n;let r=n.add(blockOffsets.flags).readU32();if((r&BLOCK_HAS_SIGNATURE)!==0){let e=(r&BLOCK_HAS_COPY_DISPOSE)!==0?2:0;this.types=t.add(blockDescriptorOffsets.rest+e*pointerSize).readPointer().readCString(),this._signature=parseSignature(this.types)}else this._signature=null}else{this.declare(n);let e=Memory.alloc(blockDescriptorAllocSize+blockSize),t=e.add(blockDescriptorAllocSize),r=Memory.allocUtf8String(this.types);e.add(blockDescriptorOffsets.reserved).writeULong(0),e.add(blockDescriptorOffsets.size).writeULong(blockDescriptorDeclaredSize),e.add(blockDescriptorOffsets.rest).writePointer(r),t.add(blockOffsets.isa).writePointer(classRegistry.__NSGlobalBlock__),t.add(blockOffsets.flags).writeU32(BLOCK_HAS_SIGNATURE|BLOCK_IS_GLOBAL),t.add(blockOffsets.reserved).writeU32(0),t.add(blockOffsets.descriptor).writePointer(e),this.handle=t,this._storage=[e,r],this.implementation=n.implementation}}Object.defineProperties(Block.prototype,{implementation:{enumerable:!0,get(){let e=this.handle.add(blockOffsets.invoke).readPointer().strip(),t=this._getSignature();return makeBlockInvocationWrapper(this,t,new NativeFunction(e.sign(),t.retType.type,t.argTypes.map(function(e){return e.type}),this._options))},set(e){let t=this._getSignature(),r=new NativeCallback(makeBlockImplementationWrapper(this,t,e),t.retType.type,t.argTypes.map(function(e){return e.type}));this._callback=r;let n=this.handle.add(blockOffsets.invoke),o=Memory.queryProtection(n),i=o.includes("w");i||Memory.protect(n,Process.pointerSize,"rw-"),n.writePointer(r.strip().sign("ia",n)),i||Memory.protect(n,Process.pointerSize,o)}},declare:{value(e){let t=e.types;t===void 0&&(t=unparseSignature(e.retType,["block"].concat(e.argTypes))),this.types=t,this._signature=parseSignature(t)}},_getSignature:{value(){let e=this._signature;if(e===null)throw new Error("block is missing signature; call declare()");return e}}});function collectProtocols(e,t){t=t||{},t[e.name]=e;let r=e.protocols;return Object.keys(r).forEach(function(e){collectProtocols(r[e],t)}),t}function registerProxy(e){let t=e.protocols||[],r=e.methods||{},i=e.events||{},n=new Set(Object.keys(r).filter(e=>/([+\-])\s(\S+)/.exec(e)!==null).map(e=>e.split(" ")[1])),o={"- dealloc":function(){let e=this.data.target;"- release"in e&&e.release(),unbind(this.self),this.super.dealloc();let t=this.data.events.dealloc;t!==void 0&&t.call(this)},"- respondsToSelector:":function(e){let t=selectorAsString(e);return n.has(t)?!0:this.data.target.respondsToSelector_(e)},"- forwardingTargetForSelector:":function(e){let t=this.data.events.forward;return t!==void 0&&t.call(this,selectorAsString(e)),this.data.target},"- methodSignatureForSelector:":function(e){return this.data.target.methodSignatureForSelector_(e)},"- forwardInvocation:":function(e){e.invokeWithTarget_(this.data.target)}};for(var a in r)if(r.hasOwnProperty(a)){if(o.hasOwnProperty(a))throw new Error("The '"+a+"' method is reserved");o[a]=r[a]}let s=registerClass({name:e.name,super:classRegistry.NSProxy,protocols:t,methods:o});return function(e,t){e=e instanceof NativePointer?new ObjCObject(e):e,t=t||{};let r=s.alloc().autorelease(),n=getBoundData(r);n.target="- retain"in e?e.retain():e,n.events=i;for(var o in t)if(t.hasOwnProperty(o)){if(n.hasOwnProperty(o))throw new Error("The '"+o+"' property is reserved");n[o]=t[o]}this.handle=r.handle}}function registerClass(e){let t=e.name;t===void 0&&(t=makeClassName());let u=e.super!==void 0?e.super:classRegistry.NSObject,p=e.protocols||[],d=e.methods||{},f=[],m=api.objc_allocateClassPair(u!==null?u.handle:NULL,Memory.allocUtf8String(t),ptr("0"));if(m.isNull())throw new Error("Unable to register already registered class '"+t+"'");let g=api.object_getClass(m);try{p.forEach(function(e){api.class_addProtocol(m,e.handle)}),Object.keys(d).forEach(function(n){let e=/([+\-])\s(\S+)/.exec(n);if(e===null)throw new Error("Invalid method name");let t=e[1],r=e[2],o,i=d[n];if(typeof i=="function"){let r=null;if(n in u)r=u[n].types;else for(let t of p){let e=t.methods[n];if(e!==void 0){r=e.types;break}}if(r===null)throw new Error("Unable to find '"+n+"' in super-class or any of its protocols");o={types:r,implementation:i}}else o=i;let a=t==="+"?g:m,s=o.types;s===void 0&&(s=unparseSignature(o.retType,[t==="+"?"class":"object","selector"].concat(o.argTypes)));let l=parseSignature(s),c=new NativeCallback(makeMethodImplementationWrapper(l,o.implementation),l.retType.type,l.argTypes.map(function(e){return e.type}));f.push(c),api.class_addMethod(a,selector(r),c,Memory.allocUtf8String(s))})}catch(e){throw api.objc_disposeClassPair(m),e}return api.objc_registerClassPair(m),m._methodCallbacks=f,Script.bindWeak(m,makeClassDestructor(ptr(m))),new ObjCObject(m)}function makeClassDestructor(e){return function(){api.objc_disposeClassPair(e)}}function registerProtocol(e){let t=e.name;t===void 0&&(t=makeProtocolName());let r=e.protocols||[],a=e.methods||{};r.forEach(function(e){if(!(e instanceof ObjCProtocol))throw new Error("Expected protocol")});let n=Object.keys(a).map(function(e){let t=a[e],r=/([+\-])\s(\S+)/.exec(e);if(r===null)throw new Error("Invalid method name");let n=r[1],o=r[2],i=t.types;return i===void 0&&(i=unparseSignature(t.retType,[n==="+"?"class":"object","selector"].concat(t.argTypes))),{kind:n,name:o,types:i,optional:t.optional}}),o=api.objc_allocateProtocol(Memory.allocUtf8String(t));if(o.isNull())throw new Error("Unable to register already registered protocol '"+t+"'");return r.forEach(function(e){api.protocol_addProtocol(o,e.handle)}),n.forEach(function(e){let t=e.optional?0:1,r=e.kind==="-"?1:0;api.protocol_addMethodDescription(o,selector(e.name),Memory.allocUtf8String(e.types),t,r)}),api.objc_registerProtocol(o),new ObjCProtocol(o)}function getHandle(e){if(e instanceof NativePointer)return e;if(typeof e=="object"&&e.hasOwnProperty("handle"))return e.handle;throw new Error("Expected NativePointer or ObjC.Object instance")}function bind(e,t){let r=getHandle(e),n=e instanceof ObjCObject?e:new ObjCObject(r);bindings.set(r.toString(),{self:n,super:n.$super,data:t})}function unbind(e){let t=getHandle(e);bindings.delete(t.toString())}function getBoundData(e){return getBinding(e).data}function getBinding(t){let r=getHandle(t),n=r.toString(),o=bindings.get(n);if(o===void 0){let e=t instanceof ObjCObject?t:new ObjCObject(r);o={self:e,super:e.$super,data:{}},bindings.set(n,o)}return o}function enumerateLoadedClasses(...e){let i=new ModuleMap,a=!1,t,s;e.length===1?t=e[0]:(t=e[1],s=e[0].ownedBy),s===void 0&&(s=i,a=!0);let l=api.class_getName,c=t.onMatch.bind(t),u=(pointerSize===8?8:11)*pointerSize,r=api.objc_getClassList(NULL,0),p=Memory.alloc(r*pointerSize);api.objc_getClassList(p,r);for(let o=0;o!==r;o++){let t=p.add(o*pointerSize).readPointer(),e=l(t),r=null,n=s.findPath(e);if(n===null&&(a||i.findPath(e)===null)&&(r=e.readCString(),r.indexOf(".")!==-1)){let e=t.add(u).readPointer();n=s.findPath(e)}n!==null&&(r===null&&(r=e.readUtf8String()),c(r,n))}t.onComplete()}function enumerateLoadedClassesSync(e={}){let n={};return enumerateLoadedClasses(e,{onMatch(e,t){let r=n[t];r===void 0&&(r=[],n[t]=r),r.push(e)},onComplete(){}}),n}function choose(e,t){let r=e,n=!0;if(!(e instanceof ObjCObject)&&typeof e=="object"&&(r=e.class,e.hasOwnProperty("subclasses")&&(n=e.subclasses)),!(r instanceof ObjCObject&&(r.$kind==="class"||r.$kind==="meta-class")))throw new Error("Expected an ObjC.Object for a class or meta-class");let o=ee().choose(r,n).map(e=>new ObjCObject(e));for(let e of o)if(t.onMatch(e)==="stop")break;t.onComplete()}function makeMethodInvocationWrapper(method,owner,superSpecifier,invocationOptions){let sel=method.sel,handle=method.handle,types;handle===void 0?(handle=null,types=method.types):types=api.method_getTypeEncoding(handle).readUtf8String();let signature=parseSignature(types),retType=signature.retType,argTypes=signature.argTypes.slice(2),objc_msgSend=superSpecifier?getMsgSendSuperImpl(signature,invocationOptions):getMsgSendImpl(signature,invocationOptions),argVariableNames=argTypes.map(function(e,t){return"a"+(t+1)}),callArgs=[superSpecifier?"superSpecifier":"this","sel"].concat(argTypes.map(function(e,t){return e.toNative?"argTypes["+t+"].toNative.call(this, "+argVariableNames[t]+")":argVariableNames[t]})),returnCaptureLeft,returnCaptureRight;retType.type==="void"?(returnCaptureLeft="",returnCaptureRight=""):retType.fromNative?(returnCaptureLeft="return retType.fromNative.call(this, ",returnCaptureRight=")"):(returnCaptureLeft="return ",returnCaptureRight="");let m=eval("var m = function ("+argVariableNames.join(", ")+") { "+returnCaptureLeft+"objc_msgSend("+callArgs.join(", ")+")"+returnCaptureRight+"; }; m;");Object.defineProperty(m,"handle",{enumerable:!0,get:getMethodHandle}),m.selector=sel,Object.defineProperty(m,"implementation",{enumerable:!0,get(){let e=getMethodHandle(),t=new NativeFunction(api.method_getImplementation(e),m.returnType,m.argumentTypes,invocationOptions),r=getReplacementMethodImplementation(e);return r!==null&&(t._callback=r),t},set(e){replaceMethodImplementation(getMethodHandle(),e)}}),m.returnType=retType.type,m.argumentTypes=signature.argTypes.map(e=>e.type),m.types=types,Object.defineProperty(m,"symbol",{enumerable:!0,get(){return`${method.kind}[${owner.$className} ${selectorAsString(sel)}]`}}),m.clone=function(e){return makeMethodInvocationWrapper(method,owner,superSpecifier,e)};function getMethodHandle(){if(handle===null){if(owner.$kind==="instance"){let r=owner;do{if("- forwardingTargetForSelector:"in r){let e=r.forwardingTargetForSelector_(sel);if(e===null||e.$kind!=="instance")break;let t=api.class_getInstanceMethod(e.$class.handle,sel);t.isNull()?r=e:handle=t}else break}while(handle===null)}if(handle===null)throw new Error("Unable to find method handle of proxied function")}return handle}return m}function makeMethodImplementationWrapper(signature,implementation){let retType=signature.retType,argTypes=signature.argTypes,argVariableNames=argTypes.map(function(e,t){return t===0?"handle":t===1?"sel":"a"+(t-1)}),callArgs=argTypes.slice(2).map(function(e,t){let r=argVariableNames[2+t];return e.fromNative?"argTypes["+(2+t)+"].fromNative.call(self, "+r+")":r}),returnCaptureLeft,returnCaptureRight;retType.type==="void"?(returnCaptureLeft="",returnCaptureRight=""):retType.toNative?(returnCaptureLeft="return retType.toNative.call(self, ",returnCaptureRight=")"):(returnCaptureLeft="return ",returnCaptureRight="");let m=eval("var m = function ("+argVariableNames.join(", ")+") { var binding = getBinding(handle);var self = binding.self;"+returnCaptureLeft+"implementation.call(binding"+(callArgs.length>0?", ":"")+callArgs.join(", ")+")"+returnCaptureRight+"; }; m;");return m}function makeBlockInvocationWrapper(block,signature,implementation){let retType=signature.retType,argTypes=signature.argTypes.slice(1),argVariableNames=argTypes.map(function(e,t){return"a"+(t+1)}),callArgs=argTypes.map(function(e,t){return e.toNative?"argTypes["+t+"].toNative.call(this, "+argVariableNames[t]+")":argVariableNames[t]}),returnCaptureLeft,returnCaptureRight;retType.type==="void"?(returnCaptureLeft="",returnCaptureRight=""):retType.fromNative?(returnCaptureLeft="return retType.fromNative.call(this, ",returnCaptureRight=")"):(returnCaptureLeft="return ",returnCaptureRight="");let f=eval("var f = function ("+argVariableNames.join(", ")+") { "+returnCaptureLeft+"implementation(this"+(callArgs.length>0?", ":"")+callArgs.join(", ")+")"+returnCaptureRight+"; }; f;");return f.bind(block)}function makeBlockImplementationWrapper(block,signature,implementation){let retType=signature.retType,argTypes=signature.argTypes,argVariableNames=argTypes.map(function(e,t){return t===0?"handle":"a"+t}),callArgs=argTypes.slice(1).map(function(e,t){let r=argVariableNames[1+t];return e.fromNative?"argTypes["+(1+t)+"].fromNative.call(this, "+r+")":r}),returnCaptureLeft,returnCaptureRight;retType.type==="void"?(returnCaptureLeft="",returnCaptureRight=""):retType.toNative?(returnCaptureLeft="return retType.toNative.call(this, ",returnCaptureRight=")"):(returnCaptureLeft="return ",returnCaptureRight="");let f=eval("var f = function ("+argVariableNames.join(", ")+") { if (!this.handle.equals(handle))this.handle = handle;"+returnCaptureLeft+"implementation.call(block"+(callArgs.length>0?", ":"")+callArgs.join(", ")+")"+returnCaptureRight+"; }; f;");return f.bind(block)}function rawFridaType(e){return e==="object"?"pointer":e}function makeClassName(){for(let t=1;;t++){let e="FridaAnonymousClass"+t;if(!(e in classRegistry))return e}}function makeProtocolName(){for(let t=1;;t++){let e="FridaAnonymousProtocol"+t;if(!(e in protocolRegistry))return e}}function objcMethodName(e){return e.replace(/_/g,":")}function jsMethodName(e){let t=e.replace(/:/g,"_");return objCObjectBuiltins.has(t)&&(t+="2"),t}let isaMasks={x64:"0x7ffffffffff8",arm64:"0xffffffff8"},rawMask=isaMasks[Process.arch];if(rawMask!==void 0){let e=ptr(rawMask);readObjectIsa=function(t){return t.readPointer().and(e)}}else readObjectIsa=function(e){return e.readPointer()};function getMsgSendImpl(e,t){return resolveMsgSendImpl(msgSendBySignatureId,e,t,!1)}function getMsgSendSuperImpl(e,t){return resolveMsgSendImpl(msgSendSuperBySignatureId,e,t,!0)}function resolveMsgSendImpl(e,t,r,n){if(r!==R)return makeMsgSendImpl(t,r,n);let{id:o}=t,i=e.get(o);return i===void 0&&(i=makeMsgSendImpl(t,r,n),e.set(o,i)),i}function makeMsgSendImpl(e,t,r){let n=e.retType.type,o=e.argTypes.map(function(e){return e.type}),i=["objc_msgSend"];r&&i.push("Super"),n instanceof Array&&!typeFitsInRegisters(n)?i.push("_stret"):(n==="float"||n==="double")&&i.push("_fpret");let a=i.join("");return new NativeFunction(api[a],n,o,t)}function typeFitsInRegisters(e){return Process.arch!=="x64"?!1:sizeOfTypeOnX64(e)<=16}function sizeOfTypeOnX64(e){if(e instanceof Array)return e.reduce((e,t)=>e+sizeOfTypeOnX64(t),0);switch(e){case"bool":case"char":case"uchar":return 1;case"int16":case"uint16":return 2;case"int":case"int32":case"uint":case"uint32":case"float":return 4;default:return 8}}function unparseSignature(e,t){let r=typeIdFromAlias(e),n=t.map(typeIdFromAlias),o=n.map(e=>singularTypeById[e].size),i=o.reduce((e,t)=>e+t,0),a=0;return r+i+n.map((e,t)=>{let r=e+a;return a+=o[t],r}).join("")}function parseSignature(e){let t=[e,0];parseQualifiers(t);let r=readType(t);readNumber(t);let n=[],o=JSON.stringify(r.type);for(;dataAvailable(t);){parseQualifiers(t);let e=readType(t);readNumber(t),n.push(e),o+=JSON.stringify(e.type)}return{id:o,retType:r,argTypes:n}}function parseType(e){return readType([e,0])}function readType(r){let t=readChar(r);if(t==="@"){let e=peekChar(r);e==="?"?(t+=e,skipChar(r),peekChar(r)==="<"&&skipExtendedBlock(r)):e==='"'&&(skipChar(r),readUntil('"',r))}else if(t==="^"){let e=peekChar(r);e==="@"&&(t+=e,skipChar(r))}let e=singularTypeById[t];if(e!==void 0)return e;if(t==="["){let e=readNumber(r),t=readType(r);return skipChar(r),arrayType(e,t)}else if(t==="{"){if(!tokenExistsAhead("=","}",r))return readUntil("}",r),structType([]);readUntil("=",r);let e=[],t;for(;(t=peekChar(r))!=="}";)t==='"'&&(skipChar(r),readUntil('"',r)),e.push(readType(r));return skipChar(r),structType(e)}else if(t==="("){readUntil("=",r);let e=[];for(;peekChar(r)!==")";)e.push(readType(r));return skipChar(r),unionType(e)}else{if(t==="b")return readNumber(r),singularTypeById.i;if(t==="^")return readType(r),singularTypeById["?"];if(modifiers.has(t))return readType(r);throw new Error("Unable to handle type "+t)}}function skipExtendedBlock(e){let t;for(skipChar(e);(t=peekChar(e))!==">";)peekChar(e)==="<"?skipExtendedBlock(e):(skipChar(e),t==='"'&&readUntil('"',e));skipChar(e)}function readNumber(r){let n="";for(;dataAvailable(r);){let e=peekChar(r),t=e.charCodeAt(0);if(t>=48&&t<=57)n+=e,skipChar(r);else break}return parseInt(n)}function readUntil(e,t){let r=t[0],n=t[1],o=r.indexOf(e,n);if(o===-1)throw new Error("Expected token '"+e+"' not found");let i=r.substring(n,o);return t[1]=o+1,i}function readChar(e){return e[0][e[1]++]}function peekChar(e){return e[0][e[1]]}function tokenExistsAhead(e,t,r){let[n,o]=r,i=n.indexOf(e,o);if(i===-1)return!1;let a=n.indexOf(t,o);if(a===-1)throw new Error("Expected to find terminator: "+t);return i<a}function skipChar(e){e[1]++}function dataAvailable(e){return e[1]!==e[0].length}let qualifierById={r:"const",n:"in",N:"inout",o:"out",O:"bycopy",R:"byref",V:"oneway"};function parseQualifiers(t){let r=[];for(;;){let e=qualifierById[peekChar(t)];if(e===void 0)break;r.push(e),skipChar(t)}return r}let idByAlias={char:"c",int:"i",int16:"s",int32:"i",int64:"q",uchar:"C",uint:"I",uint16:"S",uint32:"I",uint64:"Q",float:"f",double:"d",bool:"B",void:"v",string:"*",object:"@",block:"@?",class:"#",selector:":",pointer:"^v"};function typeIdFromAlias(e){if(typeof e=="object"&&e!==null)return`@"${e.type}"`;let t=idByAlias[e];if(t===void 0)throw new Error("No known encoding for type "+e);return t}let fromNativeId=function(e){return e.isNull()?null:e.toString(16)===this.handle.toString(16)?this:new ObjCObject(e)},toNativeId=function(e){if(e===null)return NULL;let t=typeof e;return t==="string"?(cachedNSStringCtor===null&&(cachedNSString=classRegistry.NSString,cachedNSStringCtor=cachedNSString.stringWithUTF8String_),cachedNSStringCtor.call(cachedNSString,Memory.allocUtf8String(e))):t==="number"?(cachedNSNumberCtor===null&&(cachedNSNumber=classRegistry.NSNumber,cachedNSNumberCtor=cachedNSNumber.numberWithDouble_),cachedNSNumberCtor.call(cachedNSNumber,e)):e},fromNativeBlock=function(e){return e.isNull()?null:e.toString(16)===this.handle.toString(16)?this:new Block(e)},toNativeBlock=function(e){return e!==null?e:NULL},toNativeObjectArray=function(n){if(n instanceof Array){let t=n.length,r=Memory.alloc(t*pointerSize);for(let e=0;e!==t;e++)r.add(e*pointerSize).writePointer(toNativeId(n[e]));return r}return n};function arrayType(o,i){return{type:"pointer",read(t){let r=[],n=i.size;for(let e=0;e!==o;e++)r.push(i.read(t.add(e*n)));return r},write(r,e){let n=i.size;e.forEach((e,t)=>{i.write(r.add(t*n),e)})}}}function structType(n){let e,t;if(n.some(function(e){return!!e.fromNative})){let r=n.map(function(e){return e.fromNative?e.fromNative:identityTransform});e=function(e){return e.map(function(e,t){return r[t].call(this,e)})}}else e=identityTransform;if(n.some(function(e){return!!e.toNative})){let r=n.map(function(e){return e.toNative?e.toNative:identityTransform});t=function(e){return e.map(function(e,t){return r[t].call(this,e)})}}else t=identityTransform;let[r,o]=n.reduce(function(e,t){let[r,n]=e,{size:o}=t,i=align(r,o);return n.push(i),[i+o,n]},[0,[]]);return{type:n.map(e=>e.type),size:r,read(r){return n.map((e,t)=>e.read(r.add(o[t])))},write(r,e){e.forEach((e,t)=>{n[t].write(r.add(o[t]),e)})},fromNative:e,toNative:t}}function unionType(e){let r=e.reduce(function(e,t){return t.size>e.size?t:e},e[0]),n,o;if(r.fromNative){let t=r.fromNative;n=function(e){return t.call(this,e[0])}}else n=function(e){return e[0]};if(r.toNative){let t=r.toNative;o=function(e){return[t.call(this,e)]}}else o=function(e){return[e]};return{type:[r.type],size:r.size,read:r.read,write:r.write,fromNative:n,toNative:o}}let longBits=pointerSize==8&&Process.platform!=="windows"?64:32;modifiers=new Set(["j","A","r","n","N","o","O","R","V","+"]),singularTypeById={c:{type:"char",size:1,read:e=>e.readS8(),write:(e,t)=>{e.writeS8(t)},toNative(e){return typeof e=="boolean"?e?1:0:e}},i:{type:"int",size:4,read:e=>e.readInt(),write:(e,t)=>{e.writeInt(t)}},s:{type:"int16",size:2,read:e=>e.readS16(),write:(e,t)=>{e.writeS16(t)}},l:{type:"int32",size:4,read:e=>e.readS32(),write:(e,t)=>{e.writeS32(t)}},q:{type:"int64",size:8,read:e=>e.readS64(),write:(e,t)=>{e.writeS64(t)}},C:{type:"uchar",size:1,read:e=>e.readU8(),write:(e,t)=>{e.writeU8(t)}},I:{type:"uint",size:4,read:e=>e.readUInt(),write:(e,t)=>{e.writeUInt(t)}},S:{type:"uint16",size:2,read:e=>e.readU16(),write:(e,t)=>{e.writeU16(t)}},L:{type:"uint"+longBits,size:longBits/8,read:e=>e.readULong(),write:(e,t)=>{e.writeULong(t)}},Q:{type:"uint64",size:8,read:e=>e.readU64(),write:(e,t)=>{e.writeU64(t)}},f:{type:"float",size:4,read:e=>e.readFloat(),write:(e,t)=>{e.writeFloat(t)}},d:{type:"double",size:8,read:e=>e.readDouble(),write:(e,t)=>{e.writeDouble(t)}},B:{type:"bool",size:1,read:e=>e.readU8(),write:(e,t)=>{e.writeU8(t)},fromNative(e){return!!e},toNative(e){return e?1:0}},v:{type:"void",size:0},"*":{type:"pointer",size:pointerSize,read:e=>e.readPointer(),write:(e,t)=>{e.writePointer(t)},fromNative(e){return e.readUtf8String()}},"@":{type:"pointer",size:pointerSize,read:e=>e.readPointer(),write:(e,t)=>{e.writePointer(t)},fromNative:fromNativeId,toNative:toNativeId},"@?":{type:"pointer",size:pointerSize,read:e=>e.readPointer(),write:(e,t)=>{e.writePointer(t)},fromNative:fromNativeBlock,toNative:toNativeBlock},"^@":{type:"pointer",size:pointerSize,read:e=>e.readPointer(),write:(e,t)=>{e.writePointer(t)},toNative:toNativeObjectArray},"^v":{type:"pointer",size:pointerSize,read:e=>e.readPointer(),write:(e,t)=>{e.writePointer(t)}},"#":{type:"pointer",size:pointerSize,read:e=>e.readPointer(),write:(e,t)=>{e.writePointer(t)},fromNative:fromNativeId,toNative:toNativeId},":":{type:"pointer",size:pointerSize,read:e=>e.readPointer(),write:(e,t)=>{e.writePointer(t)}},"?":{type:"pointer",size:pointerSize,read:e=>e.readPointer(),write:(e,t)=>{e.writePointer(t)}}};function identityTransform(e){return e}function align(e,t){let r=e%t;return r===0?e:e+(t-r)}}var ue=new ce,te=ue;Object.defineProperty(globalThis,"ObjC",{value:te})})();